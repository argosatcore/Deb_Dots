webpackJsonp([45],{2183:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a(2184)},2184:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=a(2185);!function(e){e[e.Unknown=0]="Unknown",e[e.Message=1]="Message",e[e.Reply=2]="Reply",e[e.Like=3]="Like"}(i=t.UserActivityType||(t.UserActivityType={}));var s=function(){return function(){}}();t.UserActivityViewModel=s;var r=function(){return function(){}}();t.ChannelViewModel=r;var c=function(){function e(e,t,a,i,n,s,r,c,o,l,h,u,g,d,v,p,m,y,S,f,b,C){var w=this;if(this.$q=e,this.$sce=t,this.$scope=a,this.$timeout=i,this.$translate=n,this.analyticsService=s,this.channelService=r,this.constants=c,this.htmlSanitizer=o,this.loggingService=l,this.navigationService=h,this.peopleService=u,this.resources=g,this.skypeSearchClient=d,this.substrateSearchRestClient=v,this.sxConfig=p,this.timeService=m,this.personalConversationService=S,this.ariaLiveService=f,this.utilityService=b,this.loadingPage=!1,this.daysDisplayedCount=14,this.pageNumber=0,this.parentMessageIdPrefixedString="messageid=",this.reachedEnd=!1,this.substrateMessageSearchEnabled=!1,this.substrateMessageSearchEnabledOtherScenarios=!1,this.substrateMessageSearchWithFallbackToOsearch=!1,this.scoredChannels={},this.nextPageActivities=null,this.activities=[],this.hasActiveChannels=!1,this.logger=l.newLogger("ActivityTab"),this.activityTabV2Settings=y.valueFor(c.settings.names.activityTabV2),this.substrateMessageSearchEnabled=y.valueAsBoolean(c.settings.names.enableSubstrateMessageSearch),this.substrateMessageSearchEnabledOtherScenarios=y.valueAsBoolean(c.settings.names.enableSubstrateMessageSearchEnabledOtherScenarios),this.substrateMessageSearchWithFallbackToOsearch=y.valueAsBoolean(c.settings.names.enableSubstrateMessageSearchWithFallbackToOsearch),this.substrateMessageSearchEchoEnabled=y.valueAsBoolean(c.settings.names.enableSubstrateMessageSearchEcho),this.enableGuestMessageSearchFrom3s=y.valueAsBoolean(c.settings.names.enableGuestMessageSearchFrom3s),this.isMemberUser=C.isMemberUserType(),this.activityTabV2Settings&&_.isString(this.activityTabV2Settings))try{this.activityTabV2Settings=JSON.parse(this.activityTabV2Settings)}catch(e){this.logger.error("Activity Tab V2 setting parsing failed. Ignoring activity tab v2 settings. Error: "+e)}this.daysDisplayedCount=this.enableRightRail?this.activityTabV2Settings.daysDisplayedCount:this.daysDisplayedCount,this.postScoreWeight=this.enableRightRail?this.activityTabV2Settings.postScoreWeight:0,this.likeScoreWeight=this.enableRightRail?this.activityTabV2Settings.likeScoreWeight:0,this.maxChannelsPerTeam=this.enableRightRail?this.activityTabV2Settings.maxChannelsPerTeam:0,this.messageSearchPageSize=this.shouldCallSubstrateMessageSearch()?c.search.pageSize3S:c.search.pageSize,this.activityScrollVsRepeat=this.shouldCallSubstrateMessageSearch()?65:93,this.scenarioName=c.scenarios.meDashboard.activityLoad,l.findScenario(this.scenarioName)||l.newScenario(this.scenarioName),a.$on("$destroy",function(e){var t=l.findScenario(w.scenarioName);t&&t.cancel()}),this.noActivityHeading=n.instant(g.strings.activity_tab_no_activity_title),this.noActivityMessage=n.instant(g.strings.activity_tab_no_activity_message),this.loadActivities()}return e.$inject=["$q","$sce","$scope","$timeout","$translate","analyticsService","channelService","constants","htmlSanitizer","loggingService","navigationService","peopleService","resources","skypeSearchClient","substrateSearchRestClient","sxConfig","timeService","settingsService","personalConversationService","ariaLiveService","utilityService","identityService"],Object.defineProperty(e.prototype,"navCtx",{get:function(){return"activity-tab"},enumerable:!0,configurable:!0}),e.prototype.constructAriaLabel=function(e){var t=e.target.dataset.focusedMessageId;if(t){var a=_.find(this.activities,function(e){return e.messageId===t});if(a){var i="";i+=this.getActivityTypeString(a.activityType),i+=" "+a.teamName+"/"+a.channelName,i+=" "+this.timeService.getTimeAgoString(new Date(a.dateTime)),i+=" "+this.getTrimmedContent(a.content.toString()),e.target.setAttribute("aria-label",i)}}},e.prototype.getAriaOwns=function(){return _.range(1,101).map(function(e){return"activity-item-"+e}).join(" ")},e.prototype.showFollowUnfollow=function(e,t){var a=this.channelService.getChannelByObjectId(t.channelId);if(a){var i=t.channelName?t.channelName.toString():"",n=t.teamName?t.teamName.toString():"",s=this.getFollowUnFollowAction(a),r=this.$translate.instant(this.resources.strings.activity_tab_channel_aria_label_format,{channelName:i,teamName:n,action:s});e.target.setAttribute("aria-label",r),e.target.setAttribute("aria-selected","true"),t.followUnfollowText=s,t.showFollowUnfollowLink=!0}else this.logger.error("Cannot show follow/unfollow action because channel: {0} could not be found.",t.channelName)},e.prototype.hideFollowUnfollow=function(e,t){t.showFollowUnfollowLink&&(e.target.setAttribute("aria-selected","false"),t.showFollowUnfollowLink=!1)},e.prototype.toggleFollowSettingForChannel=function(e,t){var a=this,i=this.channelService.getChannelByObjectId(t.channelId);if(i){var n=this.shouldToggleFavoriteSetting(t,i);(n?function(){return a.personalConversationService.toggleFavoriteSettingForChannel(i)}:function(){return a.$q.resolve()})().then(function(){a.personalConversationService.toggleFollowSettingForChannel(i).then(function(){a.logger.info("{0}: Follow/Unfollow successful",i.displayName),t.favorited=n&&i.isFollowed,t.followUnfollowText=a.getFollowUnFollowAction(i),a.ariaUpdateFollowUnFollow(i)}).catch(function(e){a.logger.error("{0}: Follow/Unfollow failed with error: {1}",i.displayName,e)})}).catch(function(e){a.logger.error("{0}: Favorite action failed with error: {1}",i.displayName,e)})}else this.logger.error("Follow/Unfollow failed because channel: {0} could not be found.",t.channelName)},Object.defineProperty(e.prototype,"enableRightRail",{get:function(){return!!this.activityTabV2Settings&&this.activityTabV2Settings.enableRightRail},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableTeamSection",{get:function(){return!!this.activityTabV2Settings&&this.activityTabV2Settings.enableTeamSection},enumerable:!0,configurable:!0}),e.prototype.loadNextPage=function(e){var t=this;!(e===this.constants.scrollEdges.bottom)||this.reachedEnd||this.loadingPage||(this.loadingPage=!0,this.pageNumber++,(this.nextPageActivities?function(){return t.$q.resolve(t.nextPageActivities)}:function(){return t.getUserActivity()})().then(function(e){t.activities=t.activities.concat(e),t.estimateSizes(t.activities)}).catch(function(e){-1==e.status?t.logger.info("Loading next page was cancelled by the user"):(t.errorInfo=e,t.logger.error("Failed to load next page with error:{0}",e),t.pageNumber--)}).finally(function(){t.nextPageActivities=null,t.loadingPage=!1}))},e.prototype.getFollowUnFollowAction=function(e){var t=this.resources.strings.activity_tab_channel_action_follow;return e.isFollowed&&(t=this.resources.strings.activity_tab_channel_action_unfollow),this.$translate.instant(t)},e.prototype.ariaUpdateFollowUnFollow=function(e){var t=e.isFollowed?this.resources.strings.activity_tab_channel_followed:this.resources.strings.activity_tab_channel_unfollowed;this.ariaLiveService.update(this.$translate.instant(t))},e.prototype.shouldToggleFavoriteSetting=function(e,t){return e.favorited||!t.isFavorite&&t.displayName!==this.constants.channels.defaultChannelName},e.prototype.loadActivities=function(){var e=this;this.wait=!0;var t=this.populateActivities(),a=this.getPersonName();this.$q.all([t,a]).then(function(t){if(null==t||t.length<2)return e.logger.error("Failed to get either user activities or name. Not showing activities"),void(e.activities=[]);e.personDisplayValue=t[1],e.wait=!1,e.loadActiveChannelsAndTeams(),e.$timeout(function(){var t=angular.element(".ts-activity-group > button.first-item");e.activities&&e.activities.length>0&&t.length&&t.focus()})}).catch(function(t){e.logger.error("Failed to find activities. Error: {0}",t)})},e.prototype.loadActiveChannelsAndTeams=function(){var e=this;if(this.activeChannelListReady=!1,this.teamListReady=!1,this.enableRightRail){var t=_.filter(this.activities,{isChannelFollowed:!1}),a=this.getUserActivity(1),i=this.getUserLikes();this.$q.all([a,i]).then(function(a){if(null==a||a.length<2)e.logger.error("Failed to get either next page of user posts or likes. Not showing active channels");else{e.nextPageActivities=a[0];var i=a[1],n=_.filter(i,{isChannelFollowed:!1}),s=_.filter(e.nextPageActivities,{isChannelFollowed:!1});t=t.concat(n),t=t.concat(s);var r=e.scoreChannels(t);e.activeChannels=_.orderBy(r,function(e){return e.score},["desc"]),e.activeChannelListReady=!0,e.sendActiveChannelsPanelView()}}).catch(function(t){e.logger.error("Failed to find active channels. Error: {0}",t)})}},e.prototype.sendActiveChannelsPanelView=function(){var e=this,t={panel:{type:teamspace.PanelType.oneOnOneChatActivityView},dataBag:{activeChannelsCount:this.activeChannels.length}};_.defer(function(){return e.analyticsService.onPanelView(e.$scope,t)})},e.prototype.getActivityTypeString=function(e){switch(e){case i.Message:return this.$translate.instant(this.resources.strings.activity_type_message);case i.Reply:return this.$translate.instant(this.resources.strings.activity_type_reply);case i.Like:return this.$translate.instant(this.resources.strings.activity_type_like);default:return""}},e.prototype.getTrimmedContent=function(e){return e.replace(/(<\/?[^>]+(>|$))|&nbsp;/g,function(e){return"&nbsp;"===e?" ":""}).trim()},e.prototype.getPersonName=function(){var e=this;if(!this.context||!this.context.mri)return this.$q.when(this.$translate.instant(this.resources.strings.activity_tab_first_activity_your));this.peopleService.getPeopleProfile(this.context.mri,"activity-tab-getPersonName").then(function(t){var a=t.givenName||t.displayName;return e.noActivityHeading=e.$translate.instant(e.resources.strings.activity_tab_other_no_activity_title),e.noActivityMessage=e.$translate.instant(e.resources.strings.activity_tab_other_no_activity_message,{firstName:a}),e.channelSectionHeader=e.$translate.instant(e.resources.strings.activity_tab_channel_section_header,{firstName:a}),e.teamSectionHeader=e.$translate.instant(e.resources.strings.activity_tab_team_section_header,{firstName:a}),a}).catch(function(t){return e.noActivityHeading=e.$translate.instant(e.resources.strings.activity_tab_other_no_activity_title),e.noActivityMessage=e.$translate.instant(e.resources.strings.activity_tab_unresolved_other_no_activity_message),e.channelSectionHeader=e.$translate.instant(e.resources.strings.activity_tab_channel_section_header_unresolved_user),e.teamSectionHeader=e.$translate.instant(e.resources.strings.activity_tab_team_section_header_unresolved_user),e.$translate.instant(e.resources.strings.activity_tab_first_activity_the)})},e.prototype.populateActivities=function(){var e=this,t=this.$q.defer();return this.getUserActivity(this.pageNumber).then(function(t){e.reachedEnd=!1,e.activities=t,e.estimateSizes(e.activities),$(".simple-scrollbar",e.$scope.element).scrollTop(0)}).catch(function(a){e.errorInfo=a,t.reject(a)}).finally(function(){t.resolve(e.activities)}),t.promise},e.prototype.onPanelChange=function(){var e=this,t=this.constants.messages.panes.activity,a={tab:{id:this.selectedItem.threadId+t,type:t},panel:{type:teamspace.PanelType.oneOnOneChatActivityView}};_.defer(function(){return e.analyticsService.onPanelView(e.$scope,a)})},e.prototype.getUserActivity=function(e){var t=this;void 0===e&&(e=-1),this.cancelPendingCalls(),this.searchTimeout=this.$q.defer();var a=this.$q.defer(),i=(e>=0?e:this.pageNumber)*this.messageSearchPageSize;return this.substrateMessageSearchEchoEnabled&&this.isMemberUser&&this.perform3SEchoCall(i),this.getSearchBackendPromise(i).then(function(e){e?t.logger.debug("{0} results returned",e.length):t.logger.debug("No results returned"),t.processSearchResults(e).then(function(e){a.resolve(e)}).catch(function(e){t.logger.error("Failed to process search results. Error: {0}",e),a.reject(e)})}).catch(function(e){t.logger.error("Failed to get activities. Error: {0}",e),a.reject(e)}),a.promise},e.prototype.perform3SEchoCall=function(e){var t=this;this.createSubstrateSearchRequest(e).then(function(e){var a={searchClientRequestId:t.utilityService.generateUUID(),searchTermEventSubType:t.constants.events.substrateSearch.userActivityFeedQueryEcho3s};t.substrateSearchRestClient.messageSearchEcho(e,a)})},e.prototype.processSearchResults=function(e,t){var a=this;if(void 0===t&&(t=null),!e||0===e.length)return this.$q.when([]);var n=this.$q.defer(),r=[],c=0;return angular.forEach(e,function(o){var l=new s,h=o.ParentReferenceId&&o.ParentReferenceId.toLowerCase().contains(a.parentMessageIdPrefixedString);l.activityType=t||(h?i.Reply:i.Message),l.parentMessageReferenceId=o.ParentReferenceId.toLowerCase(),l.messageId=null===o.ServerMessageId||void 0===o.ServerMessageId?o.ServerMessageId:o.ServerMessageId.toString(),l.dateTime=new Date(o.CreationDate).toString(),l.content=a.$sce.trustAsHtml(a.htmlSanitizer.sanitizeHtml(o.Content)),l.timestamp=new Date(o.CreationDate),l.threadId=o.ThreadId,l.globalId=l.messageId+l.threadId,a.channelService.getChannelById(o.ThreadId).then(function(e){return l.channelName=a.$sce.trustAsHtml(a.htmlSanitizer.sanitizeHtml(e.displayName)),l.isChannelFollowed=e.isFollowed,a.hasActiveChannels||e.isFollowed||(a.hasActiveChannels=!0),a.channelService.getTeamById(e.parentTeamId)}).then(function(e){l.teamName=a.$sce.trustAsHtml(a.htmlSanitizer.sanitizeHtml(e.displayName)),l.teamPictureEtag=e.pictureETag,l.groupId=e.siteInfo.groupId,r.push(l)}).catch(function(e){a.logger.debug("unable to process searchResult: {0}",JSON.stringify(o))}).finally(function(){++c===e.length&&(a.logger.debug("{0} results processed",r.length),n.resolve(r))})}),n.promise},e.prototype.shouldCallSubstrateMessageSearch=function(){return this.substrateMessageSearchEnabled&&this.substrateMessageSearchEnabledOtherScenarios&&this.isMemberUser},e.prototype.shouldCallSubstrateMessageSearchWithFallbackScenario=function(){return this.substrateMessageSearchEnabled&&this.substrateMessageSearchEnabledOtherScenarios&&this.substrateMessageSearchWithFallbackToOsearch&&(this.isMemberUser||this.enableGuestMessageSearchFrom3s)},e.prototype.openThread=function(e,t){var a=this;if(t&&"A"===t.target.nodeName)t.stopPropagation();else{this.selectedItem=e;var i=e.messageId;if(e.parentMessageReferenceId){var n=e.parentMessageReferenceId.split(";").filter(function(e){return e&&e.indexOf(a.parentMessageIdPrefixedString)>=0});n.length>0&&(i=n[0].substring(this.parentMessageIdPrefixedString.length))}this.navigationService.navigateToMessage(this.$scope,e.dateTime,e.threadId,e.messageId,i,e.messageId,this.navCtx,e.teamName,e.channelName),this.onPanelChange()}},e.prototype.cancelPendingCalls=function(){this.searchTimeout&&(this.searchTimeout.resolve(),this.searchTimeout=null)},e.prototype.estimateSizes=function(e){var t=this;_.each(e,function(e){if(!e.size){var a=e.content?e.content.toString().replace(/<br[^>]*>/g,"\n").replace(/<[^>]*>/g,"").replace(/&#(\d+);/g," ").replace("&amp;"," "):"",i=a.length>t.constants.vsRepeat.leftRail.common.lineCharCount||a.contains("\n")?t.constants.vsRepeat.leftRail.activities.largeSize:t.constants.vsRepeat.leftRail.activities.smallSize;e.size=i}})},e.prototype.getUserLikes=function(){var e=this,t={and:[{Annotation:{TYPE:"like",VALUE:{user:this.context&&this.context.mri?this.context.mri:this.sxConfig.getCurrentSkypeMri()}}},{ConversationType:"Group"}]},a={OPTION:{RESULTBASE:0,RESULTCOUNT:this.constants.search.pageSize},QUERYSTRING:t},n=this.$q.defer();return this.skypeSearchClient.search(a).then(function(t){t?e.logger.debug("{0} likes returned",t.length):e.logger.debug("No likes returned"),e.processSearchResults(t,i.Like).then(function(e){n.resolve(e)}).catch(function(t){e.logger.error("Failed to process like activities. Error: {0}",t),n.reject(t)})}).catch(function(t){e.logger.error("Failed to get likes. Error: {0}",t),n.reject(t)}),n.promise},e.prototype.scoreChannels=function(e){var t=this,a=this.loggingService.newCounter(this.constants.counters.activityTabChannelScoring);_.forEach(e,function(e){t.initializeChannelViewModel(e),t.scoreActivity(e)}),a.stop();var i=_.values(this.scoredChannels),n=_.groupBy(i,"groupId");return i=[],_.forEach(n,function(e){e=_.orderBy(e,function(e){return e.score},"desc"),i=i.concat(e.slice(0,t.maxChannelsPerTeam))}),i},e.prototype.initializeChannelViewModel=function(e){this.scoredChannels[e.threadId]||(this.scoredChannels[e.threadId]=new r,this.scoredChannels[e.threadId].channelId=e.threadId,this.scoredChannels[e.threadId].channelName=e.channelName,this.scoredChannels[e.threadId].teamName=e.teamName,this.scoredChannels[e.threadId].teamPictureEtag=e.teamPictureEtag,this.scoredChannels[e.threadId].groupId=e.groupId,this.scoredChannels[e.threadId].showFollowUnfollowLink=!1,this.scoredChannels[e.threadId].favorited=!1,this.scoredChannels[e.threadId].score=0)},e.prototype.scoreActivity=function(e){var t=e.activityType===i.Message||e.activityType===i.Reply?this.postScoreWeight:this.likeScoreWeight,a=moment(new Date),n=moment(e.timestamp),s=moment.duration(a.diff(n)).asDays(),r=t+(this.daysDisplayedCount-s);this.scoredChannels[e.threadId].score+=r},e.prototype.setActivitySearchConversationId=function(){this.activitySearchConversationId=this.activitySearchConversationId?this.activitySearchConversationId:this.utilityService.generateUUID()},e.prototype.createSubstrateSearchRequest=function(e){var t=this;return this.peopleService.getPeopleProfile(this.context.mri,"activity-tab-createSubstrateSearch").then(function(a){t.setActivitySearchConversationId();var i=[];return i.push("("+t.substrateSearchRestClient.createFromFilterValueString(a)+")"),i.push("(Extension_SkypeSpaces_ConversationPost_Extension_ThreadType_String:("+SkypeX.Services.ChatServiceUtils.ThreadType_Topic+" OR "+SkypeX.Services.ChatServiceUtils.ThreadType_Team+"))"),i.push("NOT (isClientSoftDeleted:TRUE)"),{queryString:i.join(" AND "),cvid:t.activitySearchConversationId,options:{resultBase:e,resultCount:t.messageSearchPageSize}}})},e.prototype.getSkypeSearchRequest=function(e,t){return{OPTION:{RESULTBASE:t,RESULTCOUNT:this.constants.search.pageSize},QUERYSTRING:{and:[{ConversationType:"Group"},{From:e}]}}},e.prototype.getTrimmedContentForSubstrateSearchResult=function(e){if(e.Content.length>250){var t=e.Content.substring(0,e.Content.lastIndexOf(" ",250));e.Content=t+" ..."}return e},e.prototype.trimSearchResultsForSusbstrate=function(e){var t=this,a=e.map(function(e){return t.getTrimmedContentForSubstrateSearchResult(e)});return this.$q.resolve(a)},e.prototype.setReachedSearchEnd=function(e){this.shouldCallSubstrateMessageSearch()?this.substrateSearchRestClient.moreSearchResultsAvailable(e)||(this.reachedEnd=!0):e.length<this.messageSearchPageSize&&(this.reachedEnd=!0)},e.prototype.getSearchBackendPromise=function(e){var t=this.utilityService.generateUUID();return this.shouldCallSubstrateMessageSearchWithFallbackScenario()?(this.logger.info("message search 3s with fallback to osearch for User Activity tab"),this.getSearchResultPromiseWith3SFallbackToOSearch(e,t)):this.shouldCallSubstrateMessageSearch()?(this.logger.info("message search 3s for User Activity tab"),this.get3SResultPromise(e,t)):(this.logger.info("message search osearch for User Activity tab"),this.getOSearchResultPromise(e,t))},e.prototype.getSearchResultPromiseWith3SFallbackToOSearch=function(e,t){var a=this,i=this.getSearchCallParams3S(t);return this.get3SCallPromise(e,i).then(function(e){return a.handle3SReponse(e,i)}).catch(function(n){return a.logger.error("3S Message Search Call Failed For User Activity Tab,searchClientRequestId-{0},error-{1}",i.clientRequestId,JSON.stringify(n)),a.getOSearchResultPromise(e,t)})},e.prototype.get3SResultPromise=function(e,t){var a=this,i=this.getSearchCallParams3S(t);return this.get3SCallPromise(e,i).then(function(e){return a.handle3SReponse(e,i)}).catch(function(e){return a.logger.error("3S Message Search Call Failed For User Activity Tab,searchClientRequestId-{0},error-{1}",i.clientRequestId,JSON.stringify(e)),a.$q.reject(e)})},e.prototype.getOSearchResultPromise=function(e,t){var a=this,i=this.getSearchCallParamsOsearch(t);return this.getOSearchCallPromise(e,i).then(function(e){return a.logger.info("Osearch Message Search Call Success For User Activity Tab,searchClientRequestId-{0},count-{1}",i.clientRequestId,e.length),a.setReachedSearchEnd(e),e}).catch(function(e){return a.logger.error("Osearch Message Search Call Failed For User Activity Tab,searchClientRequestId-{0},error-{1}",i.clientRequestId,JSON.stringify(e)),a.$q.reject(e)})},e.prototype.get3SCallPromise=function(e,t){var a=this;return this.createSubstrateSearchRequest(e).then(function(e){return a.substrateSearchRestClient.searchTerm(e,t)})},e.prototype.getOSearchCallPromise=function(e,t){var a=this.context&&this.context.mri?this.context.mri:this.sxConfig.getCurrentSkypeMri(),i={timeout:this.searchTimeout.promise},n=this.getSkypeSearchRequest(a,e);return this.skypeSearchClient.search(n,i,t)},e.prototype.handle3SReponse=function(e,t){var a=this;return this.setReachedSearchEnd(e.object),this.substrateSearchRestClient.process3SResponse(e).then(function(e){return a.logger.info("3S Message Search Call Success For User Activity Tab,searchClientRequestId-{0},count-{1}",t.clientRequestId,e.length),a.trimSearchResultsForSusbstrate(e)})},e.prototype.getSearchCallParams3S=function(e){return{clientRequestId:e,eventSubType:this.constants.events.substrateSearch.userActivityFeedQuery3s,scenario:this.constants.scenarios.search.substrateSearchChatUserActivityScenario,searchCallStartTime:performance.now()}},e.prototype.getSearchCallParamsOsearch=function(e){return{clientRequestId:e,eventSubType:this.getOSearchEventSubType()}},e.prototype.getOSearchEventSubType=function(){return this.shouldCallSubstrateMessageSearchWithFallbackScenario()?this.constants.events.substrateSearch.userActivityFeedQueryOsearchFallback:this.isMemberUser?this.constants.events.substrateSearch.userActivityFeedQueryOsearch:this.constants.events.substrateSearch.userActivityFeedQueryOsearchGuest},e}();t.ActivityTabController=c,angular.module("teamspace.activityTab",["teamspace.channelService","teamspace.eventingService","teamspace.htmlSanitizer","teamspace.loggingService","teamspace.peopleService","teamspace.skypeSearchClient","teamspace.substrateSearchRestClient","skypeX.sxConfig","teamspace.templateCompileService","teamspace.timeService","teamspace.routeUtilityService","teamspace.personalConversationService","teamspace.ariaLiveService"]).directive("activityTab",["templateCompileService",function(e){return{restrict:"E",scope:{hideDateDividers:"<?"},bindToController:{context:"=?"},controller:c,controllerAs:"actCtrl",link:function(t,a){e.compile("components/activity-tab/activity-tab.html",t,a)}}}]).run(["$templateCache",function(e){e.put("components/activity-tab/activity-tab.html",n)}])},2185:function(e,t){e.exports='<div ng-show="actCtrl.wait" class="busy-container">\n  <busy-animation size="medium" context="activity-tab"></busy-animation>\n</div>\n\n<div class="activity-scroll-container match-parent" ng-show="!actCtrl.wait" simple-scrollbar ng-edge-scroll bottom-threshold="0.8" on-edge-callback="actCtrl.loadNextPage(scrollEdge)" scenario-end="{{actCtrl.scenarioName}}">\n  <div class="activity-tab-container" ng-show="!actCtrl.wait">\n    <div class="activity-content" ng-class="{\'activity-fixed-width-left-rail\': actCtrl.enableRightRail && actCtrl.hasActiveChannels}">\n      <div class="activity-container match-parent" data-tid="activity-container">\n        <div class="activity-tab-empty" ng-show="actCtrl.activities.length == 0" data-tid="activity-tab-empty-activity-container">\n          <p class="text">{{actCtrl.noActivityMessage}}</p>\n        </div>\n        <div acc-role="list" aria-owns="{{::actCtrl.getAriaOwns()}}" class="match-parent flex-fill" data-tid="activity-tab-activity-group-container" ng-show="actCtrl.activities.length > 0">\n          <div class="activity-group ts-activity-group" vs-repeat="{{actCtrl.activityScrollVsRepeat}}" vs-excess="20" vs-scroll-parent=".activity-scroll-container" vs-options="{latch: true}" acc-role="vs-repeat-content-elements">\n            <button class="ts-sym left-rail-item left-rail-item-hover" ng-class="{\'left-rail-selected\': searchResult.globalId === actCtrl.selectedItem.globalId, \'first-item\': $index === 0}" ng-click="actCtrl.openThread(searchResult, $event)" ng-repeat="searchResult in actCtrl.activities track by searchResult.globalId" data-focused-message-id="{{::searchResult.messageId}}" acc-role="list-item" aria-selected="{{searchResult.globalId === actCtrl.selectedItem.globalId}}" aria-setsize="{{actCtrl.activities.length}}" aria-posinset="{{$index + startIndex + 1}}" id="activity-item-{{$index + 1}}" track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.myActivityNavItem}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.nav}}" track-name="{{::$root.trackConstants.trackModuleName.listItem}}" track-type="{{::$root.trackConstants.trackType.message}}" track-summary="{{searchResult.globalId}}" simple-focus="ctrl.constructAriaLabel($event)">\n              \x3c!-- Need this container for firefox flex display --\x3e\n              <div class="ts-activity-flex-cont">\n                <div class="type-icon" ng-class="{like: 3 === searchResult.activityType, reply: 2 === searchResult.activityType, message: 1 === searchResult.activityType}">\n                  <ng-include class="type reply" src="\'svg/icons-reply.html\'"></ng-include>\n                  <ng-include class="type message" src="\'svg/icons-chat.html\'"></ng-include>\n                  <ng-include class="type like" src="\'svg/icons-liked.html\'"></ng-include>\n                </div>\n                <div class="item-title item-subtle">{{::searchResult.teamName}}/{{::searchResult.channelName}}</div>\n                <span class="item-detail" ng-bind-html="::searchResult.content"></span>\n                <span class="item-time item-subtle" time-ago="searchResult.timestamp"></span>\n              </div>\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="activity-right-rail" ng-if="actCtrl.enableRightRail && actCtrl.hasActiveChannels && actCtrl.activities.length > 0" role="complementary">\n      <div class="channel-section">\n        <span class="channel-section-header">{{actCtrl.channelSectionHeader}}</span>\n        <div class="busy-container" ng-show="!actCtrl.activeChannelListReady">\n          <busy-animation size="medium" context="activity-tab-channel-section"></busy-animation>\n        </div>\n\n        <div class="channel-list-container" ng-show="actCtrl.activeChannelListReady" data-tid="activity-tab-channel-list-container">\n          <ul acc-role="list" data-tid="active-channels" aria-label="{{::actCtrl.channelSectionHeader}}.">\n            <li class="active-channel left-rail-item-hover" ng-repeat="channel in actCtrl.activeChannels track by $index" id="channel-{{::channel.groupId}}-{{::channel.channelName}}" acc-role="list-item" ng-focus="actCtrl.showFollowUnfollow($event, channel)" ng-blur="actCtrl.hideFollowUnfollow($event, channel)" ng-mouseenter="actCtrl.showFollowUnfollow($event, channel)" ng-mouseleave="actCtrl.hideFollowUnfollow($event, channel)" data-tid="channel-{{::channel.groupId}}-{{::channel.channelName}}">\n              <div data-tid="active-channel-{{::channel.groupId}}" aria-hidden="true">\n                <profile-picture css-class="team-icon" title="{{::channel.teamName}}" display-name="channel.teamName" team-id="channel.groupId" etag="channel.teamPictureEtag" retain-in-cache="true" source="activity-tab"></profile-picture>\n                <div>\n                  <div class="active-channel-details" ng-class="{\'active-channel-details-cut\': channel.showFollowUnfollowLink}">\n                    <span class="active-channel-name" title="{{::channel.channelName}}">{{::channel.channelName}}</span>\n                    <span class="app-small-font active-team-name" title="{{::channel.teamName}}">{{::channel.teamName}}</span>\n                  </div>\n                  <div class="active-channel-follow" ng-if="channel.showFollowUnfollowLink">\n                    <a ng-click="actCtrl.toggleFollowSettingForChannel($event, channel)" track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.activityTabFollowUnfollow}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.rightRail}}" track-name="{{::$root.trackConstants.trackModuleName.activityDashboard}}" track-type="{{::$root.trackConstants.trackType.other}}" track-data="{ action: \'{{channel.followUnfollowText}}\' }" track-summary="{{channel.followUnfollowText}}" data-tid="activity-tab-follow-unfollow-link">\n                      {{channel.followUnfollowText}}\n                    </a>\n                  </div>\n                </div>\n              </div>\n            </li>\n          </ul>\n        </div>\n      </div>\n\n      <div class="team-section" ng-if="actCtrl.enableTeamSection">\n        <span class="team-section-header">{{actCtrl.teamSectionHeader}}</span>\n        <div class="busy-container" ng-show="!actCtrl.teamListReady">\n          <busy-animation size="medium" context="activity-tab-team-section"></busy-animation>\n        </div>\n\n        <div class="team-list-container" ng-show="actCtrl.teamListReady"></div>\n      </div>\n    </div>\n  </div>\n</div>\n'}},[2183]);