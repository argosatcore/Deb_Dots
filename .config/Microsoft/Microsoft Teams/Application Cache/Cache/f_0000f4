webpackJsonp([40],{2522:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),s(2523)},2523:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s(2524),i=function(){function t(t,e,s,n,i,a,o,c,r,l,g,u,h,d){var m=this;this.teamMembershipPropertiesService=s,this.$translate=i,this.navigationService=a,this.resources=o,this.$state=c,this.$rootScope=r,this.tenantService=l,this.loggingService=g,this.constants=u,this.rightPaneStateService=h,this.dialogService=d,this.displayedSuggestions=[],this.manifest=[],this.suggestionsList=[],this.useDefaultSuggestions=!1,this.suggestionsList=e.valueFor(u.channelWelcomeSuggestedActionAttrs.configAttrs.actionList);var A=e.valueFor(u.channelWelcomeSuggestedActionAttrs.configAttrs.suggestionManifestVersion),f=e.valueFor(u.channelWelcomeSuggestedActionAttrs.configAttrs.suggestionTextVersion);this.cdnBaseUri=e.getStaticsUri();var p=n.getRootRouteParams();t.resolveTeamAndChannel(p.threadId).then(function(t){m.team=t.team,m.setRole(),m.setTeamType(),m.setTitle()}).then(function(){return m.setLocaleString(f)}).then(function(){return m.setManifest(A)}).then(function(){m.setDisplayedSuggestions()})}return t.$inject=["channelService","settingsService","teamMembershipPropertiesService","routeUtilityService","$translate","navigationService","resources","$state","$rootScope","tenantService","loggingService","constants","rightPaneStateService","dialogService"],t.prototype.setRole=function(){this.team&&angular.isDefined(this.team.objectId)&&(this.role=this.teamMembershipPropertiesService.getRole(this.team.objectId))},t.prototype.setTeamType=function(){this.team&&angular.isDefined(this.team.teamType)&&(this.teamType=this.team.teamType)},t.prototype.setTitle=function(){this.titleString=this.$translate.instant(this.resources.strings.welcome_to_class).replace("{0}",String(this.team.displayName))},t.prototype.setLocaleString=function(t){var e=this,s=this.loggingService.newScenario(this.constants.channelWelcomeSuggestedActionAttrs.scenario.fetchLocaleString),n=this.$translate.use()||"en-us",i=this.cdnBaseUri+this.constants.channelWelcomeSuggestedActionAttrs.urlCdnPath+"/Assets/locale-"+n+".json?v="+t;return fetch(i).then(function(t){if(t.ok)return t.json();throw new Error("Failed to fetch locale strings data.")}).then(function(t){if(e.localeString=t.strings,!e.localeString)throw new Error("Invalid locale strings data: missing strings");s.stop()}).catch(function(t){e.useDefaultSuggestions=!0,s.fail({errorInfo:t})})},t.prototype.setManifest=function(t){var e=this,s=this.loggingService.newScenario(this.constants.channelWelcomeSuggestedActionAttrs.scenario.fetchManifestFile),n=this.cdnBaseUri+this.constants.channelWelcomeSuggestedActionAttrs.urlCdnPath+"/manifest.json?v="+t;return fetch(n).then(function(t){if(t.ok)return t.json();throw new Error("Failed to fetch manifest data at "+n)}).then(function(t){if(!e.isValidManifestFile(t))throw new Error("Invalid manifest data");e.manifest=t[e.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.suggestions],s.stop()}).catch(function(t){e.useDefaultSuggestions=!0,s.fail({errorInfo:t})})},t.prototype.isNullOrUndefined=function(t){return null==t||void 0==t},t.prototype.isValidAppParams=function(t){if(this.isNullOrUndefined(t[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.toState]))return!1;if(this.isNullOrUndefined(t[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.navStateParams]))return!1;var e=this.constants.channelWelcomeSuggestedActionAttrs.navParametersWhitelist,s=t[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.navStateParams];return!!Object.keys(s).every(function(t){return!!e.includes(t)})},t.prototype.isValidTabParams=function(t){return!this.isNullOrUndefined(t[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.middlePane])},t.prototype.isValidDialogParams=function(t){return!this.isNullOrUndefined(t[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.dialogName])&&!this.isNullOrUndefined(t[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.data])},t.prototype.isValidRightPaneParams=function(t){return!this.isNullOrUndefined(t[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.rightPaneType])},t.prototype.isValidActionName=function(t,e){switch(t){case this.constants.channelWelcomeSuggestedActionAttrs.actionType.app:return this.isValidAppParams(e);case this.constants.channelWelcomeSuggestedActionAttrs.actionType.tab:return this.isValidTabParams(e);case this.constants.channelWelcomeSuggestedActionAttrs.actionType.dialog:return this.isValidDialogParams(e);case this.constants.channelWelcomeSuggestedActionAttrs.actionType.rightPane:return this.isValidRightPaneParams(e);default:return!1}},t.prototype.isValidManifestFile=function(t){var e=this;if(this.isNullOrUndefined(t))return!1;var s=t[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.suggestions];return!this.isNullOrUndefined(s)&&s.every(function(t){if(e.isNullOrUndefined(t[e.constants.channelWelcomeSuggestedActionAttrs.configAttrs.suggestionId]))return!1;if(e.isNullOrUndefined(t[e.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.imgId]))return!1;if(e.isNullOrUndefined(t[e.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.altText]))return!1;if(e.isNullOrUndefined(t[e.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.text]))return!1;if(e.isNullOrUndefined(t[e.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.btnText]))return!1;if(e.isNullOrUndefined(t[e.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.btnAction]))return!1;var s=t[e.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.btnAction];if(e.isNullOrUndefined(s[e.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.action]))return!1;if(e.isNullOrUndefined(s[e.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.parameters]))return!1;var n=s[e.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.action],i=s[e.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.parameters];return e.isValidActionName(n,i)})},t.prototype.isValidTeamTypeSuggestion=function(t){var e=this;return t.every(function(t){return!e.isNullOrUndefined(t[e.constants.channelWelcomeSuggestedActionAttrs.configAttrs.suggestionId])&&!e.isNullOrUndefined(t[e.constants.channelWelcomeSuggestedActionAttrs.configAttrs.imgVersion])})},t.prototype.isValidUserTypeSuggestion=function(t){var e=this;return!this.isNullOrUndefined(t[this.constants.teamType.class])&&Object.keys(t).every(function(s){var n=t[s];return!e.isNullOrUndefined(n)&&!!e.isValidTeamTypeSuggestion(n)})},t.prototype.isValidSuggestionList=function(t){if(this.isNullOrUndefined(t))return!1;var e=t[this.constants.RoleConstants.Admin],s=t[this.constants.RoleConstants.User],n=t[this.constants.RoleConstants.Guest];return!(this.isNullOrUndefined(e)||this.isNullOrUndefined(s)||this.isNullOrUndefined(n))&&(this.isValidUserTypeSuggestion(e)&&this.isValidUserTypeSuggestion(s)&&this.isValidUserTypeSuggestion(n))},t.prototype.setDisplayedSuggestions=function(){var t=this,e=this.loggingService.newScenario(this.constants.channelWelcomeSuggestedActionAttrs.scenario.displagedSuggestions),s={};try{if(!this.isValidSuggestionList(this.suggestionsList))throw this.useDefaultSuggestions=!0,Error("Invalid suggestionAction configs, double check ecs config file.");this.useDefaultSuggestions||(s.role=this.role,s.teamType=this.teamType,this.displayedSuggestions=this.suggestionsList[this.role][this.getTeamTypeString(this.teamType)].map(function(e){var n=e[t.constants.channelWelcomeSuggestedActionAttrs.configAttrs.suggestionId];return s[n]="displaying",t.buildDisplayedSuggestion(e)}))}catch(t){e.fail({errorInfo:t})}finally{this.useDefaultSuggestions&&(s.useDefaultSuggestions="true",this.displayedSuggestions=this.getDefaultSuggestions()),e.stop(s)}},t.prototype.getDefaultSuggestions=function(){var t=[{suggestionId:"ViewStudentRoster2",altText:this.$translate.instant(this.resources.strings.view_student_roster),btnText:this.$translate.instant(this.resources.strings.view_student_roster),img:"https://statics.teams.cdn.office.net/hashedassets/statics/EmptyStateSuggestions/Assets/Image/view-student-roster-ee0f1b3.svg",btnAction:{action:this.constants.channelWelcomeSuggestedActionAttrs.actionType.rightPane,parameters:{rightPaneType:"info"}}},{suggestionId:"UploadClassMaterials",altText:this.$translate.instant(this.resources.strings.upload_class_materials),btnText:this.$translate.instant(this.resources.strings.upload_class_materials),img:"https://statics.teams.cdn.office.net/hashedassets/statics/EmptyStateSuggestions/Assets/Image/upload-class-materials-32e54a2.svg",btnAction:{action:this.constants.channelWelcomeSuggestedActionAttrs.actionType.tab,parameters:{middlePane:"files"}}},{suggestionId:"SetUpClassNotebook",altText:this.$translate.instant(this.resources.strings.set_up_class_notebook),btnText:this.$translate.instant(this.resources.strings.set_up_class_notebook),img:"https://statics.teams.cdn.office.net/hashedassets/statics/EmptyStateSuggestions/Assets/Image/set-up-class-notebook-86a9287.svg",btnAction:{action:this.constants.channelWelcomeSuggestedActionAttrs.actionType.tab,parameters:{middlePane:"ClassNotebook"}}}],e=[{suggestionId:"ViewStudentRoster",altText:this.$translate.instant(this.resources.strings.view_student_roster),btnText:this.$translate.instant(this.resources.strings.view_student_roster),img:"https://statics.teams.cdn.office.net/hashedassets/statics/EmptyStateSuggestions/Assets/Image/view-student-roster-ee0f1b3.svg"}];return this.role==this.constants.RoleConstants.Admin&&this.getTeamTypeString(this.teamType)==this.constants.teamType.class?t:e},t.prototype.getTeamTypeString=function(t){switch(t){case 1:return this.constants.teamType.edu;case 2:return this.constants.teamType.class;case 3:return this.constants.teamType.plc;case 4:return this.constants.teamType.staff;default:return""}},t.prototype.buildDisplayedSuggestion=function(t){var e=this,s=t[this.constants.channelWelcomeSuggestedActionAttrs.configAttrs.suggestionId],n=t[this.constants.channelWelcomeSuggestedActionAttrs.configAttrs.imgVersion],i=this.manifest.find(function(t){return t[e.constants.channelWelcomeSuggestedActionAttrs.configAttrs.suggestionId]==s}),a=this.getImgPath(i[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.imgId],n),o=this.getAltText(i[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.altText]),c=this.getText(i[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.text]),r=this.getBtnText(i[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.btnText]),l=i[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.btnAction];return{suggestionId:s,altText:o,text:c,btnText:r,img:a,btnAction:l}},t.prototype.getImgPath=function(t,e){return this.cdnBaseUri+this.constants.channelWelcomeSuggestedActionAttrs.urlCdnPath+"/Assets/Image/"+t+"?v="+e},t.prototype.getAltText=function(t){return this.localeString[t]},t.prototype.getText=function(t){return this.localeString[t]},t.prototype.getBtnText=function(t){return this.localeString[t]},t.prototype.btnClick=function(t){var e=this.loggingService.newScenario(this.constants.channelWelcomeSuggestedActionAttrs.scenario.suggestedActionClicked+t[this.constants.channelWelcomeSuggestedActionAttrs.configAttrs.suggestionId]),s={},n=t[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.btnAction];if(n)try{s[this.handleAction(n)]="click succeeded"}catch(t){e.fail({errorInfo:t})}finally{s.actions_displayed=this.displayedSuggestions.reduce(function(t,e){return t+e.suggestionId.toString()+";"},""),e.stop(s)}else e.fail({errorInfo:"Invalid manifest data: missing btnAction"})},t.prototype.handleAction=function(t){var e=t[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.action],s=t[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.parameters];if(!s)throw Error("Invalid manifest data: missing parameters");switch(e){case this.constants.channelWelcomeSuggestedActionAttrs.actionType.app:this.handleNavigateToApp(s);break;case this.constants.channelWelcomeSuggestedActionAttrs.actionType.tab:this.handleNavigateToTab(s);break;case this.constants.channelWelcomeSuggestedActionAttrs.actionType.dialog:this.handleDialogFunction(s);break;case this.constants.channelWelcomeSuggestedActionAttrs.actionType.rightPane:this.handleRightPaneFunction(s);break;default:throw Error("Invalid actionName, please add support for this action.")}return e},t.prototype.handleNavigateToApp=function(t){var e=this.buildNavStateParams(t[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.navStateParams]),s=this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.stateOptions;this.navigationService.navigatePromise(this.$rootScope,t[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.toState],e,!1,void 0==t[s]?"":t[s])},t.prototype.handleNavigateToTab=function(t){var e={slug:this.team.objectId,middlePane:t[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.middlePane],threadId:this.team.objectId,ctx:this.constants.navigation.context.channel,navCtx:"channel"};this.navigationService.navigatePromise(this.$rootScope,this.constants.states.appConversation,e,!1)},t.prototype.handleRightPaneFunction=function(t){this.rightPaneStateService.togglePane(this.$rootScope,t[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.rightPaneType])},t.prototype.handleDialogFunction=function(t){this.dialogService.open(t[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.dialogName],t[this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.data])},t.prototype.buildNavStateParams=function(t){var e=this,s={};return Object.keys(t).forEach(function(n){s[n]=e.getParamValueByKey(t,n)}),s},t.prototype.getParamValueByKey=function(t,e){if("undefined"==t[e])switch(e){case this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.threadId:return this.team.objectId;case this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.teamName:return this.team.displayName;case this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.groupId:return this.team&&this.team.siteInfo&&this.team.siteInfo.groupId;case this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.messageId:return this.$state.params.messageId;case this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.tenantName:return this.tenantService.getCurrentTenantName();case this.constants.channelWelcomeSuggestedActionAttrs.manifestAttrs.groupName:return this.team.displayName;default:throw new Error("Invalid manifest data: invalid navStateParams")}return t[e]},t}();e.ChannelWelcomeSuggestedActions=i,angular.module("teamspace.channelWelcomeSuggestedActions",["teamspace.appsService","teamspace.conversationsService","teamspace.dialogService","teamspace.extensionDefinitionService","teamspace.loggingService","teamspace.routeUtilityService","teamspace.settingsService","teamspace.utilityService","teamspace.rightPaneStateService","teamspace.navigationService"]).controller("ChannelWelcomeSuggestedActions",i).run(["$templateCache",function(t){t.put("lazy-components/channel-welcome-suggested-actions/channel-welcome-suggested-actions.html",n)}])},2524:function(t,e){t.exports='<div ng-controller="ChannelWelcomeSuggestedActions as cwsa" aria-label="{{cwsa.titleString}}">\n  <div class="analytics-panel" analytics-panel="{{::$root.trackConstant.PanelRegion.main}}" analytics-panel-on-root="true" analytics-panel-view="{ panel: {type: {{::$root.trackConstants.panelType.channelEmptyState}}}}">\n      <ul class="edu-wm-canvas">\n        <div class="title" data-tid="edu-channel-welcome-title">{{cwsa.titleString}}</div>\n        <div class="text" data-tid="edu-channel-welcome-admin-text" translate-once="{{::$root.resources.strings.choose_where_to_start}}" ng-if="cwsa.role == \'Admin\'"></div>\n        <div class="text" data-tid="edu-channel-welcome-non-admin-text" translate-once="{{::$root.resources.strings.messages_emptyListHeader_class}}" ng-if="cwsa.role != \'Admin\'"></div>\n        <div class="sections">\n          <li ng-repeat="suggestedAction in cwsa.displayedSuggestions track by suggestedAction.suggestionId">\n            <section>\n              <img class="section-image" ng-src="{{suggestedAction.img}}" alt="{{suggestedAction.altText}}" data-tid="edu-channel-welcome-suggested-action-image"/>\n              <button ng-if="cwsa.role == \'Admin\'" class="ts-btn ts-btn-fluent ts-btn-fluent-secondary" ng-click="cwsa.btnClick(suggestedAction)" data-tid="edu-channel-welcome-suggested-action-button" track-gesture="{{::$root.trackConstants.trackGesture.click}}" track-outcome="{{::$root.trackConstants.trackOutcome.nav}}" track-name="{{::$root.trackConstants.trackModuleName.teamWelcomeMessage}}" track-scenario="{{::$root.trackConstants.trackScenario.channelWelcomeSuggestedActions}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.Tms_Conv_ChannelWelcomeSuggestedActions}}" track-type="{{::$root.trackConstants.trackType.button}}" track-summary="{{suggestedAction.btnText}}" track-state="{{suggestedAction.suggestionId}}" aria-label="{{suggestedAction.btnText}}">\n                      {{suggestedAction.btnText}}\n                    </button>\n            </section>\n          </li>\n        </div>\n      </ul>\n  </div>\n</div>'}},[2522]);