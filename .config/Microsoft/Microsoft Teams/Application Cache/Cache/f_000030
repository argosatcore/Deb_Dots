var $jscomp={scope:{},getGlobal:function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global?global:e}};$jscomp.global=$jscomp.getGlobal(this),$jscomp.initSymbol=function(){$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol),$jscomp.initSymbol=function(){}},$jscomp.symbolCounter_=0,$jscomp.Symbol=function(e){return"jscomp_symbol_"+e+$jscomp.symbolCounter_++},$jscomp.initSymbolIterator=function(){$jscomp.initSymbol(),$jscomp.global.Symbol.iterator||($jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator")),$jscomp.initSymbolIterator=function(){}},$jscomp.makeIterator=function(e){if($jscomp.initSymbolIterator(),e[$jscomp.global.Symbol.iterator])return e[$jscomp.global.Symbol.iterator]();var t=0;return{next:function(){return t==e.length?{done:!0}:{done:!1,value:e[t++]}}}},$jscomp.arrayFromIterator=function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n},$jscomp.arrayFromIterable=function(e){return e instanceof Array?e:$jscomp.arrayFromIterator($jscomp.makeIterator(e))},$jscomp.inherits=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e;for(var i in t)if($jscomp.global.Object.defineProperties){var o=$jscomp.global.Object.getOwnPropertyDescriptor(t,i);o&&$jscomp.global.Object.defineProperty(e,i,o)}else e[i]=t[i]},$jscomp.array=$jscomp.array||{},$jscomp.array.done_=function(){return{done:!0,value:void 0}},$jscomp.array.arrayIterator_=function(e,t){e instanceof String&&(e=String(e));var n=0;$jscomp.initSymbol(),$jscomp.initSymbolIterator();var i={},o=(i.next=function(){if(n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return o.next=$jscomp.array.done_,$jscomp.array.done_()},i[Symbol.iterator]=function(){return o},i);return o},$jscomp.array.findInternal_=function(e,t,n){e instanceof String&&(e=String(e));for(var i=e.length,o=0;o<i;o++){var r=e[o];if(t.call(n,r,o,e))return{i:o,v:r}}return{i:-1,v:void 0}},$jscomp.array.from=function(e,t,n){t=void 0===t?function(e){return e}:t;var i=[];if($jscomp.initSymbol(),$jscomp.initSymbolIterator(),e[Symbol.iterator]){$jscomp.initSymbol(),$jscomp.initSymbolIterator(),e=e[Symbol.iterator]();for(var o;!(o=e.next()).done;)i.push(t.call(n,o.value))}else{o=e.length;for(var r=0;r<o;r++)i.push(t.call(n,e[r]))}return i},$jscomp.array.of=function(e){for(var t=[],n=0;n<arguments.length;++n)t[n-0]=arguments[n];return $jscomp.array.from(t)},$jscomp.array.entries=function(){return $jscomp.array.arrayIterator_(this,function(e,t){return[e,t]})},$jscomp.array.entries$install=function(){Array.prototype.entries||(Array.prototype.entries=$jscomp.array.entries)},$jscomp.array.keys=function(){return $jscomp.array.arrayIterator_(this,function(e){return e})},$jscomp.array.keys$install=function(){Array.prototype.keys||(Array.prototype.keys=$jscomp.array.keys)},$jscomp.array.values=function(){return $jscomp.array.arrayIterator_(this,function(e,t){return t})},$jscomp.array.values$install=function(){Array.prototype.values||(Array.prototype.values=$jscomp.array.values)},$jscomp.array.copyWithin=function(e,t,n){var i=this.length;if(e=Number(e),t=Number(t),n=Number(null!=n?n:i),e<t)for(n=Math.min(n,i);t<n;)t in this?this[e++]=this[t++]:(delete this[e++],t++);else for(n=Math.min(n,i+t-e),e+=n-t;n>t;)--n in this?this[--e]=this[n]:delete this[e];return this},$jscomp.array.copyWithin$install=function(){Array.prototype.copyWithin||(Array.prototype.copyWithin=$jscomp.array.copyWithin)},$jscomp.array.fill=function(e,t,n){for(null!=n&&e.length||(n=this.length||0),n=Number(n),t=Number((void 0===t?0:t)||0);t<n;t++)this[t]=e;return this},$jscomp.array.fill$install=function(){Array.prototype.fill||(Array.prototype.fill=$jscomp.array.fill)},$jscomp.array.find=function(e,t){return $jscomp.array.findInternal_(this,e,t).v},$jscomp.array.find$install=function(){Array.prototype.find||(Array.prototype.find=$jscomp.array.find)},$jscomp.array.findIndex=function(e,t){return $jscomp.array.findInternal_(this,e,t).i},$jscomp.array.findIndex$install=function(){Array.prototype.findIndex||(Array.prototype.findIndex=$jscomp.array.findIndex)},$jscomp.Map=function(e){if(e=void 0===e?[]:e,this.data_={},this.head_=$jscomp.Map.createHead_(),this.size=0,e)for(var t=(e=$jscomp.makeIterator(e)).next();!t.done;t=e.next())t=t.value,this.set(t[0],t[1])},$jscomp.Map.checkBrowserConformance_=function(){var e=$jscomp.global.Map;if(!e||!e.prototype.entries||!Object.seal)return!1;try{var t=Object.seal({x:4}),n=new e($jscomp.makeIterator([[t,"s"]]));if("s"!=n.get(t)||1!=n.size||n.get({x:4})||n.set({x:4},"t")!=n||2!=n.size)return!1;var i=n.entries(),o=i.next();return!o.done&&o.value[0]==t&&"s"==o.value[1]&&!((o=i.next()).done||4!=o.value[0].x||"t"!=o.value[1]||!i.next().done)}catch(e){return!1}},$jscomp.Map.createHead_=function(){var e={};return e.previous=e.next=e.head=e},$jscomp.Map.getId_=function(e){return e instanceof Object?($jscomp.Map.key_ in e||e instanceof Object&&Object.isExtensible&&Object.isExtensible(e)&&$jscomp.Map.defineProperty_(e,$jscomp.Map.key_,++$jscomp.Map.index_),$jscomp.Map.key_ in e?e[$jscomp.Map.key_]:" "+e):String(e)},$jscomp.Map.prototype.set=function(e,t){var n=(o=this.maybeGetEntry_(e)).id,i=o.list,o=o.entry;return i||(i=this.data_[n]=[]),o?o.value=t:(o={next:this.head_,previous:this.head_.previous,head:this.head_,key:e,value:t},i.push(o),this.head_.previous.next=o,this.head_.previous=o,this.size++),this},$jscomp.Map.prototype.delete=function(e){var t=this.maybeGetEntry_(e);e=t.id;var n=t.list,i=t.index;return!(!(t=t.entry)||!n)&&(n.splice(i,1),n.length||delete this.data_[e],t.previous.next=t.next,t.next.previous=t.previous,t.head=null,this.size--,!0)},$jscomp.Map.prototype.clear=function(){this.data_={},this.head_=this.head_.previous=$jscomp.Map.createHead_(),this.size=0},$jscomp.Map.prototype.has=function(e){return!!this.maybeGetEntry_(e).entry},$jscomp.Map.prototype.get=function(e){return(e=this.maybeGetEntry_(e).entry)&&e.value},$jscomp.Map.prototype.maybeGetEntry_=function(e){var t=$jscomp.Map.getId_(e),n=this.data_[t];if(n)for(var i=0;i<n.length;i++){var o=n[i];if(e!==e&&o.key!==o.key||e===o.key)return{id:t,list:n,index:i,entry:o}}return{id:t,list:n,index:-1,entry:void 0}},$jscomp.Map.prototype.entries=function(){return this.iter_(function(e){return[e.key,e.value]})},$jscomp.Map.prototype.keys=function(){return this.iter_(function(e){return e.key})},$jscomp.Map.prototype.values=function(){return this.iter_(function(e){return e.value})},$jscomp.Map.prototype.forEach=function(e,t){for(var n=$jscomp.makeIterator(this.entries()),i=n.next();!i.done;i=n.next())i=i.value,e.call(t,i[1],i[0],this)},$jscomp.Map.prototype.iter_=function(e){var t=this,n=this.head_;$jscomp.initSymbol(),$jscomp.initSymbolIterator();var i={};return i.next=function(){if(n){for(;n.head!=t.head_;)n=n.previous;for(;n.next!=n.head;)return n=n.next,{done:!1,value:e(n)};n=null}return{done:!0,value:void 0}},i[Symbol.iterator]=function(){return this},i},$jscomp.Map.index_=0,$jscomp.Map.defineProperty_=Object.defineProperty?function(e,t,n){Object.defineProperty(e,t,{value:String(n)})}:function(e,t,n){e[t]=String(n)},$jscomp.Map.Entry_=function(){},$jscomp.Map.ASSUME_NO_NATIVE=!1,$jscomp.Map$install=function(){$jscomp.initSymbol(),$jscomp.initSymbolIterator(),!$jscomp.Map.ASSUME_NO_NATIVE&&$jscomp.Map.checkBrowserConformance_()?$jscomp.Map=$jscomp.global.Map:($jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Map.prototype[Symbol.iterator]=$jscomp.Map.prototype.entries,$jscomp.initSymbol(),$jscomp.Map.key_=Symbol("map-id-key")),$jscomp.Map$install=function(){}},$jscomp.math=$jscomp.math||{},$jscomp.math.clz32=function(e){if(0==(e=Number(e)>>>0))return 32;var t=0;return 0==(4294901760&e)&&(e<<=16,t+=16),0==(4278190080&e)&&(e<<=8,t+=8),0==(4026531840&e)&&(e<<=4,t+=4),0==(3221225472&e)&&(e<<=2,t+=2),0==(2147483648&e)&&t++,t},$jscomp.math.imul=function(e,t){var n=65535&(e=Number(e)),i=65535&(t=Number(t));return n*i+((e>>>16&65535)*i+n*(t>>>16&65535)<<16>>>0)|0},$jscomp.math.sign=function(e){return 0===(e=Number(e))||isNaN(e)?e:0<e?1:-1},$jscomp.math.log10=function(e){return Math.log(e)/Math.LN10},$jscomp.math.log2=function(e){return Math.log(e)/Math.LN2},$jscomp.math.log1p=function(e){if(.25>(e=Number(e))&&-.25<e){for(var t=e,n=1,i=e,o=0,r=1;o!=i;)t*=e,r*=-1,i=(o=i)+r*t/++n;return i}return Math.log(1+e)},$jscomp.math.expm1=function(e){if(.25>(e=Number(e))&&-.25<e){for(var t=e,n=1,i=e,o=0;o!=i;)t*=e/++n,i=(o=i)+t;return i}return Math.exp(e)-1},$jscomp.math.cosh=function(e){return e=Number(e),(Math.exp(e)+Math.exp(-e))/2},$jscomp.math.sinh=function(e){return 0===(e=Number(e))?e:(Math.exp(e)-Math.exp(-e))/2},$jscomp.math.tanh=function(e){if(0===(e=Number(e)))return e;var t=(1-(t=Math.exp(2*-Math.abs(e))))/(1+t);return 0>e?-t:t},$jscomp.math.acosh=function(e){return e=Number(e),Math.log(e+Math.sqrt(e*e-1))},$jscomp.math.asinh=function(e){if(0===(e=Number(e)))return e;var t=Math.log(Math.abs(e)+Math.sqrt(e*e+1));return 0>e?-t:t},$jscomp.math.atanh=function(e){return e=Number(e),($jscomp.math.log1p(e)-$jscomp.math.log1p(-e))/2},$jscomp.math.hypot=function(e,t,n){for(var i=[],o=2;o<arguments.length;++o)i[o-2]=arguments[o];e=Number(e),t=Number(t);for(var r=Math.max(Math.abs(e),Math.abs(t)),a=$jscomp.makeIterator(i),o=a.next();!o.done;o=a.next())r=Math.max(r,Math.abs(o.value));if(1e100<r||1e-100>r){for(a=(e/=r)*e+(t/=r)*t,o=(i=$jscomp.makeIterator(i)).next();!o.done;o=i.next())o=o.value,o=Number(o)/r,a+=o*o;return Math.sqrt(a)*r}for(r=e*e+t*t,o=(i=$jscomp.makeIterator(i)).next();!o.done;o=i.next())o=o.value,o=Number(o),r+=o*o;return Math.sqrt(r)},$jscomp.math.trunc=function(e){if(e=Number(e),isNaN(e)||1/0===e||-1/0===e||0===e)return e;var t=Math.floor(Math.abs(e));return 0>e?-t:t},$jscomp.math.cbrt=function(e){if(0===e)return e;e=Number(e);var t=Math.pow(Math.abs(e),1/3);return 0>e?-t:t},$jscomp.number=$jscomp.number||{},$jscomp.number.isFinite=function(e){return"number"==typeof e&&(!isNaN(e)&&1/0!==e&&-1/0!==e)},$jscomp.number.isInteger=function(e){return!!$jscomp.number.isFinite(e)&&e===Math.floor(e)},$jscomp.number.isNaN=function(e){return"number"==typeof e&&isNaN(e)},$jscomp.number.isSafeInteger=function(e){return $jscomp.number.isInteger(e)&&Math.abs(e)<=$jscomp.number.MAX_SAFE_INTEGER},$jscomp.number.EPSILON=Math.pow(2,-52),$jscomp.number.MAX_SAFE_INTEGER=9007199254740991,$jscomp.number.MIN_SAFE_INTEGER=-9007199254740991,$jscomp.object=$jscomp.object||{},$jscomp.object.assign=function(e,t){for(var n=[],i=1;i<arguments.length;++i)n[i-1]=arguments[i];for(i=(n=$jscomp.makeIterator(n)).next();!i.done;i=n.next())if(i=i.value)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o]);return e},$jscomp.object.is=function(e,t){return e===t?0!==e||1/e==1/t:e!==e&&t!==t},$jscomp.Set=function(e){if(e=void 0===e?[]:e,this.map_=new $jscomp.Map,e)for(var t=(e=$jscomp.makeIterator(e)).next();!t.done;t=e.next())this.add(t.value);this.size=this.map_.size},$jscomp.Set.checkBrowserConformance_=function(){var e=$jscomp.global.Set;if(!e||!e.prototype.entries||!Object.seal)return!1;var t=Object.seal({x:4});if((e=new e($jscomp.makeIterator([t]))).has(t)||1!=e.size||e.add(t)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var n=(e=e.entries()).next();return!n.done&&n.value[0]==t&&n.value[1]==t&&(!(n=e.next()).done&&n.value[0]!=t&&4==n.value[0].x&&n.value[1]==n.value[0]&&e.next().done)},$jscomp.Set.prototype.add=function(e){return this.map_.set(e,e),this.size=this.map_.size,this},$jscomp.Set.prototype.delete=function(e){return e=this.map_.delete(e),this.size=this.map_.size,e},$jscomp.Set.prototype.clear=function(){this.map_.clear(),this.size=0},$jscomp.Set.prototype.has=function(e){return this.map_.has(e)},$jscomp.Set.prototype.entries=function(){return this.map_.entries()},$jscomp.Set.prototype.values=function(){return this.map_.values()},$jscomp.Set.prototype.forEach=function(e,t){var n=this;this.map_.forEach(function(i){return e.call(t,i,i,n)})},$jscomp.Set.ASSUME_NO_NATIVE=!1,$jscomp.Set$install=function(){!$jscomp.Set.ASSUME_NO_NATIVE&&$jscomp.Set.checkBrowserConformance_()?$jscomp.Set=$jscomp.global.Set:($jscomp.Map$install(),$jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Set.prototype[Symbol.iterator]=$jscomp.Set.prototype.values),$jscomp.Set$install=function(){}},$jscomp.string=$jscomp.string||{},$jscomp.string.noRegExp_=function(e,t){if(e instanceof RegExp)throw new TypeError("First argument to String.prototype."+t+" must not be a regular expression")},$jscomp.string.fromCodePoint=function(e){for(var t=[],n=0;n<arguments.length;++n)t[n-0]=arguments[n];for(var n="",i=(t=$jscomp.makeIterator(t)).next();!i.done;i=t.next()){if(i=i.value,0>(i=+i)||1114111<i||i!==Math.floor(i))throw new RangeError("invalid_code_point "+i);65535>=i?n+=String.fromCharCode(i):(i-=65536,n+=String.fromCharCode(i>>>10&1023|55296),n+=String.fromCharCode(1023&i|56320))}return n},$jscomp.string.repeat=function(e){var t=this.toString();if(0>e||1342177279<e)throw new RangeError("Invalid count value");e|=0;for(var n="";e;)1&e&&(n+=t),(e>>>=1)&&(t+=t);return n},$jscomp.string.repeat$install=function(){String.prototype.repeat||(String.prototype.repeat=$jscomp.string.repeat)},$jscomp.string.codePointAt=function(e){var t=this.toString(),n=t.length;if(0<=(e=Number(e)||0)&&e<n){e|=0;var i=t.charCodeAt(e);return 55296>i||56319<i||e+1===n?i:56320>(e=t.charCodeAt(e+1))||57343<e?i:1024*(i-55296)+e+9216}},$jscomp.string.codePointAt$install=function(){String.prototype.codePointAt||(String.prototype.codePointAt=$jscomp.string.codePointAt)},$jscomp.string.includes=function(e,t){return t=void 0===t?0:t,$jscomp.string.noRegExp_(e,"includes"),-1!==this.toString().indexOf(e,t)},$jscomp.string.includes$install=function(){String.prototype.includes||(String.prototype.includes=$jscomp.string.includes)},$jscomp.string.startsWith=function(e,t){t=void 0===t?0:t,$jscomp.string.noRegExp_(e,"startsWith");var n=this.toString();e+="";for(var i=n.length,o=e.length,r=Math.max(0,Math.min(0|t,n.length)),a=0;a<o&&r<i;)if(n[r++]!=e[a++])return!1;return a>=o},$jscomp.string.startsWith$install=function(){String.prototype.startsWith||(String.prototype.startsWith=$jscomp.string.startsWith)},$jscomp.string.endsWith=function(e,t){$jscomp.string.noRegExp_(e,"endsWith");var n=this.toString();e+="",void 0===t&&(t=n.length);for(var i=Math.max(0,Math.min(0|t,n.length)),o=e.length;0<o&&0<i;)if(n[--i]!=e[--o])return!1;return 0>=o},$jscomp.string.endsWith$install=function(){String.prototype.endsWith||(String.prototype.endsWith=$jscomp.string.endsWith)};var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(a=2&n[0]?r.return:n[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,r=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=0<a.length&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3]))c.label=n[1];else if(6===n[0]&&c.label<a[1])c.label=a[1],a=n;else{if(!(a&&c.label<a[2])){a[2]&&c.ops.pop(),c.trys.pop();continue}c.label=a[2],c.ops.push(n)}}n=t.call(e,c)}catch(e){n=[6,e],r=0}finally{o=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,r,a,s,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return $jscomp.initSymbol(),$jscomp.initSymbol(),$jscomp.initSymbolIterator(),s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};define("logger",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.tracing=!1,this.mslogger_=void 0,this.tag=e,this.enabled=!0}return e.prototype.setMSLogger=function(e){this.mslogger_=e},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(void 0!=this.mslogger_?this.mslogger_.info(this.tag+" "+e):console.log(this.tag+" "+e))},e.prototype.trace=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.tracing&&this.log.apply(this,e)},e}();t.Logger=n,t.logger=new n("[HdxWebRTC.js]"),t.logger.enabled=!0}),define("util",["require","exports","logger"],function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),e=function(){function e(){}return e.stringifyArray=function(e){for(var t="[",n=0;n<e.length;++n)0!=n&&(t+=","),t+=this.stringify(e[n]);return t+"]"},e.stringifyObject=function(e){var t,n="{",i=!0;for(t in e)i?i=!1:n+=",",n=n+'"'+t+'":',n=e[t]instanceof Array?n+this.stringifyArray(e[t]):"object"==typeof e[t]?n+this.stringifyObject(e[t]):n+JSON.stringify(e[t]);return n+"}"},e.stringify=function(e){return"object"==typeof e?"[object Array]"==Object.prototype.toString.call(e)?this.stringifyArray(e):this.stringifyObject(e):JSON.stringify(e)},e.GetObjectPropertyDescriptor=function(e,t){for(var n=void 0;e!=Object.prototype&&void 0===(n=Object.getOwnPropertyDescriptor(e,t));)e=e.__proto__;return n},e.sendEvent=function(e,t){try{var i=document.createEvent("Event");i.initEvent(t,!0,!0),e.dispatchEvent(i)}catch(e){n.logger.log('sendEvent(): exception dispatching "'+t+'" event: '+e.message)}},e}(),t.Util=e}),define("webrpcclassinfo",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.HDXMS_VERSION="1.3.0.5";v=function(e,t,n,i){this.major=e,this.minor=t,this.revision=n,this.build=i};t.VersionData=v;var n=function(){};t.FeatureData=n,n=function(e,t){this.fature=e,this.version=t},t.FEATURE_ms_teams_redirection="ms_teams_redirection",t.FEATURE_ms_teams_desktop_sharing="ms_teams_desktop_sharing",t.FEATURE_ms_teams_speaking_indicator="ms_teams_speaking_indicator",t.FEATURE_ms_teams_common_media_constraints="ms_teams_common_media_constraints",new n(t.FEATURE_ms_teams_redirection,new v(1,1,0,0)),new n(t.FEATURE_ms_teams_desktop_sharing,new v(1,2,0,0)),new n(t.FEATURE_ms_teams_speaking_indicator,new v(1,2,0,0)),new n(t.FEATURE_ms_teams_common_media_constraints,new v(1,4,0,0)),t.featureNameMap={},t.featureNameMap.screenshare=[t.FEATURE_ms_teams_desktop_sharing],t.featureNameMap.redirection=[t.FEATURE_ms_teams_redirection],t.featureNameMap.speaking_indicator=[t.FEATURE_ms_teams_speaking_indicator],function(e){e[e.EngineControl=0]="EngineControl",e[e.RTCPeerConnection=1]="RTCPeerConnection",e[e.RTCSessionDescription=2]="RTCSessionDescription",e[e.RTCIceCandidate=3]="RTCIceCandidate",e[e.RTCIceCandidateEvent=4]="RTCIceCandidateEvent",e[e.MediaDevices=5]="MediaDevices",e[e.MediaDeviceInfo=6]="MediaDeviceInfo",e[e.MediaStreamTrack=7]="MediaStreamTrack",e[e.MediaStreamEvent=8]="MediaStreamEvent",e[e.MediaStream=9]="MediaStream",e[e.NavigatorUserMedia=10]="NavigatorUserMedia",e[e.VideoElement=11]="VideoElement",e[e.AudioElement=12]="AudioElement",e[e.RTCRtpReceiver=13]="RTCRtpReceiver"}(v=t.class_id_t||(t.class_id_t={})),function(e){e[e.ctor=0]="ctor",e[e.version=1]="version",e[e.feature_flags=2]="feature_flags",e[e.version_info=3]="version_info"}(n=t.method_id_EngineControl_t||(t.method_id_EngineControl_t={}));var i;!function(e){e[e.ctor=0]="ctor",e[e.localDescription=1]="localDescription",e[e.remoteDescription=2]="remoteDescription",e[e.readyState=3]="readyState",e[e.iceState=4]="iceState",e[e.localStreams=5]="localStreams",e[e.remoteStreams=6]="remoteStreams",e[e.createOffer=7]="createOffer",e[e.createAnswer=8]="createAnswer",e[e.setLocalDescription=9]="setLocalDescription",e[e.setRemoteDescription=10]="setRemoteDescription",e[e.updateIce=11]="updateIce",e[e.addIceCandidate=12]="addIceCandidate",e[e.addStream=13]="addStream",e[e.removeStream=14]="removeStream",e[e.close=15]="close",e[e.iceConnectionState=16]="iceConnectionState",e[e.iceGatheringState=17]="iceGatheringState",e[e.signalingState=18]="signalingState",e[e.onaddstream=19]="onaddstream",e[e.onicecandidate=20]="onicecandidate",e[e.oniceconnectionstatechange=21]="oniceconnectionstatechange",e[e.onicegatheringstatechange=22]="onicegatheringstatechange",e[e.onsignalingstatechange=23]="onsignalingstatechange",e[e.onnegotiationneeded=24]="onnegotiationneeded",e[e.onremovestream=25]="onremovestream",e[e.getStats=26]="getStats",e[e.getReceivers=27]="getReceivers"}(i=t.method_id_RTCPeerConnection_t||(t.method_id_RTCPeerConnection_t={}));var o;!function(e){e[e.ctor=0]="ctor",e[e.enumerateDevices=1]="enumerateDevices",e[e.getDisplayMedia=2]="getDisplayMedia",e[e.ondevicechange=3]="ondevicechange"}(o=t.method_id_MediaDevices_t||(t.method_id_MediaDevices_t={}));var r;!function(e){e[e.ctor=0]="ctor",e[e.deviceId=1]="deviceId",e[e.kind=2]="kind",e[e.label=3]="label",e[e.groupId=4]="groupId"}(r=t.method_id_MediaDeviceInfo_t||(t.method_id_MediaDeviceInfo_t={}));var a;!function(e){e[e.ctor=0]="ctor",e[e.type=1]="type",e[e.sdp=2]="sdp"}(a=t.method_id_RTCSessionDescription_t||(t.method_id_RTCSessionDescription_t={}));var s;!function(e){e[e.ctor=0]="ctor",e[e.kind=1]="kind",e[e.id=2]="id",e[e.label=3]="label",e[e.enabled=4]="enabled",e[e.muted=5]="muted",e[e.readyState=6]="readyState",e[e.onended=7]="onended",e[e.onmute=8]="onmute",e[e.onunmute=9]="onunmute",e[e.clone=10]="clone",e[e.stop=11]="stop",e[e.getCapabilities=12]="getCapabilities",e[e.getSettings=13]="getSettings",e[e.applyConstraints=14]="applyConstraints"}(s=t.method_id_MediaStreamTrack_t||(t.method_id_MediaStreamTrack_t={}));var c;!function(e){e[e.ctor=0]="ctor",e[e.id=1]="id",e[e.getAudioTracks=2]="getAudioTracks",e[e.getVideoTracks=3]="getVideoTracks",e[e.getTracks=4]="getTracks",e[e.getTrackById=5]="getTrackById",e[e.addTrack=6]="addTrack",e[e.removeTrack=7]="removeTrack",e[e.clone=8]="clone",e[e.active=9]="active"}(c=t.method_id_MediaStream_t||(t.method_id_MediaStream_t={}));var d;!function(e){e[e.ctor=0]="ctor",e[e.getUserMedia=1]="getUserMedia"}(d=t.method_id_NavigatorUserMedia_t||(t.method_id_NavigatorUserMedia_t={}));var l;!function(e){e[e.ctor=0]="ctor",e[e.candidate=1]="candidate",e[e.sdpMid=2]="sdpMid",e[e.sdpMLineIndex=3]="sdpMLineIndex"}(l=t.method_id_RTCIceCandidate_t||(t.method_id_RTCIceCandidate_t={}));var u;!function(e){e[e.ctor=0]="ctor",e[e.candidate=1]="candidate"}(u=t.method_id_RTCIceCandidateEvent_t||(t.method_id_RTCIceCandidateEvent_t={}));var g;!function(e){e[e.ctor=0]="ctor",e[e.stream=1]="stream"}(g=t.method_id_MediaStreamEvent_t||(t.method_id_MediaStreamEvent_t={}));var h;!function(e){e[e.ctor=0]="ctor",e[e.sinkId=1]="sinkId",e[e.connectTo=2]="connectTo",e[e.disconnect=3]="disconnect",e[e.setFrame=4]="setFrame",e[e.addClipRect=5]="addClipRect",e[e.removeClipRect=6]="removeClipRect",e[e.onerror=7]="onerror",e[e.onvideoframechanged=8]="onvideoframechanged"}(h=t.method_id_VideoElement_t||(t.method_id_VideoElement_t={}));var m;!function(e){e[e.ctor=0]="ctor",e[e.sinkId=1]="sinkId",e[e.srcObject=2]="srcObject",e[e.src=3]="src",e[e.play=4]="play",e[e.pause=5]="pause"}(m=t.method_id_AudioElement_t||(t.method_id_AudioElement_t={}));var f;!function(e){e[e.ctor=0]="ctor",e[e.track=1]="track",e[e.getContributingSources=2]="getContributingSources"}(f=t.method_id_RTCRtpReceiver_t||(t.method_id_RTCRtpReceiver_t={}));var p=function(e,n,i,o,r){void 0===r&&(r=t.FEATURE_ms_teams_redirection),this.iid=e,this.mid=n,this.name=i,this.isprop=o,this.feature=r};t.WebrpcMethodInfo=p;var _=function(e,t,n){this.id=e,this.name=t,this.methods=n};t.WebrpcClassInfo=_;var y=new function(e,t){this.name=e,this.classes=t}("msteams_class_library",[new _(v.EngineControl,"EngineControl",[new p(v.EngineControl,n.ctor,"ctor",!1),new p(v.EngineControl,n.version,"version",!0),new p(v.EngineControl,n.feature_flags,"feature_flags",!0),new p(v.EngineControl,n.version_info,"version_info",!0,t.FEATURE_ms_teams_desktop_sharing)]),new _(v.RTCPeerConnection,"RTCPeerConnection",[new p(v.RTCPeerConnection,i.ctor,"ctor",!1),new p(v.RTCPeerConnection,i.localDescription,"localDescription",!0),new p(v.RTCPeerConnection,i.remoteDescription,"remoteDescription",!0),new p(v.RTCPeerConnection,i.readyState,"readyState",!0),new p(v.RTCPeerConnection,i.iceState,"iceState",!0),new p(v.RTCPeerConnection,i.localStreams,"localStreams",!0),new p(v.RTCPeerConnection,i.remoteStreams,"remoteStreams",!0),new p(v.RTCPeerConnection,i.createOffer,"createOffer",!1),new p(v.RTCPeerConnection,i.createAnswer,"createAnswer",!1),new p(v.RTCPeerConnection,i.setLocalDescription,"setLocalDescription",!1),new p(v.RTCPeerConnection,i.setRemoteDescription,"setRemoteDescription",!1),new p(v.RTCPeerConnection,i.updateIce,"updateIce",!0),new p(v.RTCPeerConnection,i.addIceCandidate,"addIceCandidate",!0),new p(v.RTCPeerConnection,i.addStream,"addStream",!0),new p(v.RTCPeerConnection,i.removeStream,"removeStream",!0),new p(v.RTCPeerConnection,i.close,"close",!0),new p(v.RTCPeerConnection,i.iceConnectionState,"iceConnectionState",!0),new p(v.RTCPeerConnection,i.iceGatheringState,"iceGatheringState",!0),new p(v.RTCPeerConnection,i.signalingState,"signalingState",!0),new p(v.RTCPeerConnection,i.onaddstream,"onaddstream",!0),new p(v.RTCPeerConnection,i.onicecandidate,"onicecandidate",!0),new p(v.RTCPeerConnection,i.oniceconnectionstatechange,"oniceconnectionstatechange",!0),new p(v.RTCPeerConnection,i.onicegatheringstatechange,"onicegatheringstatechange",!0),new p(v.RTCPeerConnection,i.onsignalingstatechange,"onsignalingstatechange",!0),new p(v.RTCPeerConnection,i.onnegotiationneeded,"onnegotiationneeded",!0),new p(v.RTCPeerConnection,i.onremovestream,"onremovestream",!0),new p(v.RTCPeerConnection,i.getStats,"getStats",!1),new p(v.RTCPeerConnection,i.getReceivers,"getReceivers",!1,t.FEATURE_ms_teams_speaking_indicator)]),new _(v.RTCSessionDescription,"RTCSessionDescription",[new p(v.RTCSessionDescription,a.ctor,"ctor",!1),new p(v.RTCSessionDescription,a.type,"type",!0),new p(v.RTCSessionDescription,a.sdp,"sdp",!0)]),new _(v.RTCIceCandidate,"RTCIceCandidate",[new p(v.RTCIceCandidate,l.ctor,"ctor",!1),new p(v.RTCIceCandidate,l.candidate,"candidate",!0),new p(v.RTCIceCandidate,l.sdpMid,"sdpMid",!0),new p(v.RTCIceCandidate,l.sdpMLineIndex,"sdpMLineIndex",!0)]),new _(v.RTCIceCandidateEvent,"RTCIceCandidateEvent",[new p(v.RTCIceCandidateEvent,u.ctor,"ctor",!1),new p(v.RTCIceCandidateEvent,u.candidate,"candidate",!0)]),new _(v.MediaDevices,"MediaDevices",[new p(v.MediaDevices,o.ctor,"ctor",!1),new p(v.MediaDevices,o.enumerateDevices,"enumerateDevices",!1),new p(v.MediaDevices,o.getDisplayMedia,"getDisplayMedia",!1,t.FEATURE_ms_teams_desktop_sharing),new p(v.MediaDevices,o.ondevicechange,"ondevicechange",!0,t.FEATURE_ms_teams_speaking_indicator)]),new _(v.MediaDeviceInfo,"MediaDeviceInfo",[new p(v.MediaDeviceInfo,r.ctor,"ctor",!1),new p(v.MediaDeviceInfo,r.deviceId,"deviceId",!0),new p(v.MediaDeviceInfo,r.kind,"kind",!0),new p(v.MediaDeviceInfo,r.label,"label",!0),new p(v.MediaDeviceInfo,r.groupId,"groupId",!0)]),new _(v.MediaStreamTrack,"MediaStreamTrack",[new p(v.MediaStreamTrack,s.ctor,"ctor",!1),new p(v.MediaStreamTrack,s.clone,"clone",!1),new p(v.MediaStreamTrack,s.stop,"stop",!1),new p(v.MediaStreamTrack,s.getCapabilities,"getCapabilities",!1),new p(v.MediaStreamTrack,s.getSettings,"getSettings",!1),new p(v.MediaStreamTrack,s.applyConstraints,"applyConstraints",!1,t.FEATURE_ms_teams_desktop_sharing),new p(v.MediaStreamTrack,s.kind,"kind",!0),new p(v.MediaStreamTrack,s.id,"id",!0),new p(v.MediaStreamTrack,s.label,"label",!0),new p(v.MediaStreamTrack,s.enabled,"enabled",!0),new p(v.MediaStreamTrack,s.muted,"muted",!0),new p(v.MediaStreamTrack,s.readyState,"readyState",!0),new p(v.MediaStreamTrack,s.onended,"onended",!0),new p(v.MediaStreamTrack,s.onmute,"onmute",!0),new p(v.MediaStreamTrack,s.onunmute,"onunmute",!0)]),new _(v.MediaStream,"MediaStream",[new p(v.MediaStream,c.ctor,"ctor",!1),new p(v.MediaStream,c.id,"id",!0),new p(v.MediaStream,c.getAudioTracks,"getAudioTracks",!1),new p(v.MediaStream,c.getVideoTracks,"getVideoTracks",!1),new p(v.MediaStream,c.getTracks,"getTracks",!1),new p(v.MediaStream,c.getTrackById,"getTrackById",!1),new p(v.MediaStream,c.addTrack,"addTrack",!1),new p(v.MediaStream,c.removeTrack,"removeTrack",!1),new p(v.MediaStream,c.clone,"clone",!0),new p(v.MediaStream,c.active,"active",!0)]),new _(v.NavigatorUserMedia,"NavigatorUserMedia",[new p(v.NavigatorUserMedia,d.ctor,"ctor",!1),new p(v.NavigatorUserMedia,d.getUserMedia,"getUserMedia",!1)]),new _(v.MediaStreamEvent,"MediaStreamEvent",[new p(v.MediaStreamEvent,g.ctor,"ctor",!1),new p(v.MediaStreamEvent,g.stream,"stream",!0)]),new _(v.VideoElement,"VideoElement",[new p(v.VideoElement,h.ctor,"ctor",!1),new p(v.VideoElement,h.sinkId,"sinkId",!0),new p(v.VideoElement,h.connectTo,"connectTo",!1),new p(v.VideoElement,h.disconnect,"disconnect",!1),new p(v.VideoElement,h.setFrame,"setFrame",!1),new p(v.VideoElement,h.addClipRect,"addClipRect",!1),new p(v.VideoElement,h.removeClipRect,"removeClipRect",!1),new p(v.VideoElement,h.onerror,"onerror",!0),new p(v.VideoElement,h.onvideoframechanged,"onvideoframechanged",!0)]),new _(v.AudioElement,"AudioElement",[new p(v.AudioElement,m.ctor,"ctor",!1),new p(v.AudioElement,m.sinkId,"sinkId",!0),new p(v.AudioElement,m.srcObject,"srcObject",!0),new p(v.AudioElement,m.src,"src",!0),new p(v.AudioElement,m.play,"play",!1),new p(v.AudioElement,m.pause,"pause",!1)]),new _(v.RTCRtpReceiver,"RTCRtpReceiver",[new p(v.RTCRtpReceiver,f.ctor,"ctor",!1,t.FEATURE_ms_teams_speaking_indicator),new p(v.RTCRtpReceiver,f.track,"track",!0,t.FEATURE_ms_teams_speaking_indicator),new p(v.RTCRtpReceiver,f.getContributingSources,"getContributingSources",!1,t.FEATURE_ms_teams_speaking_indicator)])]),v=function(){function e(){}return e.getInterfaceByid=function(e){for(var t=0,n=y.classes;t<n.length;t++){var i=n[t];if(i.id==e)return i}return null},e.getMethodByid=function(e,t){if(null!=(i=this.getInterfaceByid(e)))for(var n=0,i=i.methods;n<i.length;n++){var o=i[n];if(o.mid==t)return o}return null},e.getMethodFeatureByid=function(e,t){if(null!=(i=this.getInterfaceByid(e)))for(var n=0,i=i.methods;n<i.length;n++){var o=i[n];if(o.mid==t)return o.feature}return null},e.composeClassInfoData=function(e){if(void 0==(e=e.hdr))return"*** Invalid packet: Couldn't find hdr object ***";if(void 0==(t=e.proc))return"";e=t.iid;for(var t=t.methodid,n=0,i=y.classes;n<i.length;n++){var o=i[n];if(o.id==e)for(var r=0,a=o.methods;r<a.length;r++){var s=a[r];if(s.mid==t)return o.name+"::"+s.name}}return""},e}();t.WebrpcClassLibInfoUtil=v}),define("wsjsonutil",["require","exports","webrpcclassinfo"],function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i;!function(e){e[e.req=0]="req",e[e.reply=1]="reply",e[e.event_req=2]="event_req",e[e.event_reply=3]="event_reply"}(i=t.ws_msg_type_t||(t.ws_msg_type_t={})),e=function(){function e(){}return e.createMessageByid=function(e,t,i,o,r,a){for(var s=[],c=6;c<arguments.length;c++)s[c-6]=arguments[c];return(c=n.WebrpcClassLibInfoUtil.getMethodByid(o,r))&&c.isprop||(e=!1),this.createMessage.apply(this,[i,e,t,o,r,a].concat(s))},e.createMessage=function(e,t,n,i,o,r){for(var a=[],s=6;s<arguments.length;s++)a[s-6]=arguments[s];return{v:"webrtc",hdr:{version:this._version,msg_type:this.getMsgType(e),modifier:t,destroy:n,proc:{iid:i,methodid:o}},objref:{oid:r},params:a.slice()}},e.getMsgType=function(e){var t="";switch(e){default:t="req";break;case i.reply:t="reply";break;case i.event_req:t="event-req";break;case i.event_reply:t="event-reply"}return t},e._version=1,e}(),t.WsJsonUtil=e}),define("garbagecollector",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.parent_=this.object_=null,this.children_=[],this.object_=e}return e.prototype.addChild=function(e){e.parent_!=this&&(e.parent_=this,this.children_.push(e))},e.prototype.removeChild=function(e){var t=this.children_.indexOf(e);this.children_.splice(t,1),e.parent_=null},e}(),i=function(){function e(){this.root_=new n(null)}return e.prototype.trackObject=function(e,t){if(void 0===t&&(t=null),null===this.findNode(e,this.root_)){var i=this.findNode(t,this.root_),o=new n(e);i.addChild(o)}},e.prototype.releaseObject=function(e){return null!==(e=this.findNode(e,this.root_))&&e!==this.root_&&(this.destroyNodeObjectRecurse(e),e.parent_.removeChild(e),!0)},e.prototype.destroyNodeObjectRecurse=function(e){for(var t=0,n=e.children_;t<n.length;t++)this.destroyNodeObjectRecurse(n[t]);e.object_.destroy()},e.prototype.setParent=function(e,t){var n=this.findNode(e,this.root_);if(null===n)return!1;var i=this.findNode(t,this.root_);return null!==i&&(n.parent_===i||(n.parent_.removeChild(n),i.addChild(n),!0))},e.prototype.reset=function(){this.root_.children_=[]},e.prototype.findNode=function(e,t){if(t.object_===e)return t;for(var n=null,i=0,o=t.children_;i<o.length&&null===(n=this.findNode(e,o[i]));i++);return n},e}();t.GC=i,t.gc=new i}),define("proxyobject","require exports hdxms logger wsjsonutil garbagecollector webrpcclassinfo".split(" "),function(e,t,n,i,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t,n){this.resolve=e,this.reject=t,this.name=n}return e.prototype.post=function(e){1==e?(i.logger.log('deferred_action.post(): resolving "'+this.name+'"'),this.resolve()):(i.logger.log('deferred_action.post(): rejecting "'+this.name+'"'),this.reject())},e}();t.deferred_action=s;var c=function(e,t){this.id=e,this.is_null=t};t.rpc_callback=c;var d=function(){function e(e,t,n){this.success=new c(e<<16,t),this.fail=new c(e<<16|1,t),this.id=e,this.oneShot=n}return e.prototype.resolve=function(e){i.logger.trace("callback.resolve() called. [id="+this.id+"]"),null!=this.handler&&this.handler(e)},e.prototype.reject=function(){null!=this.err_handler&&this.err_handler()},e.prototype.then=function(e){this.handler=e},e.prototype.prom=function(){var e=this;return new Promise(function(t,n){e.handler=t,e.err_handler=n})},e}();t.callback=d;var l;!function(e){e[e.NotConfigured=0]="NotConfigured",e[e.Configured=1]="Configured",e[e.Error=2]="Error",e[e.Destroyed=3]="Destroyed"}(l||(l={})),e=function(){function e(t,s,c,d,u){void 0===u&&(u=null);for(var g=[],h=5;h<arguments.length;h++)g[h-5]=arguments[h];var m=this;this.hdxms=n.getRedirector(),this.iid=s,this.oid=c,this.state=l.NotConfigured,this.deferredActions=[],this.cbs=new Map,0==d?(h=!1,this.iid===a.class_id_t.EngineControl&&(h=!0),this.hdxms.startRedirection(h,this.user_friendly_id()).then(function(){m.oid=e.nextId++;var t=a.WebrpcClassLibInfoUtil.getMethodFeatureByid(s,0);return m.hdxms.WSSendObjectWrapper(t,s,0,o.WsJsonUtil.createMessageByid.apply(o.WsJsonUtil,[!1,!1,o.ws_msg_type_t.req,s,0,m.oid].concat(g)))}).then(function(e){i.logger.trace("ProxyObject: setting state to configured. (iid: "+m.iid+" oid: "+m.oid+")"),m.state=l.Configured,m.oid=m.param0(e),m.onConnected(),u&&u(),r.gc.trackObject(m,t)}).catch(function(){m.state=l.Error,m.onConnected()})):(this.state=l.Configured,r.gc.trackObject(this,t))}return e.prototype.reconstructor=function(e,t,n){for(var s=this,c=[],d=3;d<arguments.length;d++)c[d-3]=arguments[d];this.state=l.NotConfigured,this.deferredActions=[],d=a.WebrpcClassLibInfoUtil.getMethodFeatureByid(t,0),this.hdxms.WSSendObjectWrapper(d,t,0,o.WsJsonUtil.createMessageByid.apply(o.WsJsonUtil,[!1,!1,o.ws_msg_type_t.req,t,0,this.oid].concat(c))).then(function(t){i.logger.trace("ProxyObject: setting state to configured. (iid: "+s.iid+" oid: "+s.oid+")"),s.state=l.Configured,s.oid=s.param0(t),s.onConnected(),r.gc.trackObject(s,e)}).catch(function(){s.state=l.Error,s.onConnected()})},e.prototype.setParent=function(e){r.gc.setParent(this,e)},e.prototype.release=function(){i.logger.log(this.user_friendly_id()+".release() called."),r.gc.releaseObject(this)},e.prototype.destroy=function(){this.state=l.Destroyed;var e=a.WebrpcClassLibInfoUtil.getMethodFeatureByid(this.iid,0);this.hdxms.WSSendObjectWrapper(e,this.iid,0,o.WsJsonUtil.createMessageByid(!1,!0,o.ws_msg_type_t.req,this.iid,0,this.oid))},e.prototype.onConnected=function(){for(;this.deferredActions&&0<this.deferredActions.length;)this.deferredActions.shift().post(this.state==l.Configured)},e.prototype.checkState=function(e,t){var n=this;0>=e?(i.logger.log("ProxyObject.checkState() timeout waiting for connection response! failed. (iid: "+n.iid+" oid: "+n.oid+")"),n.onConnected()):setTimeout(function(){n.state==l.Configured?n.onConnected():n.state==l.Error?n.onConnected():n.state==l.Destroyed?n.onConnected():(i.logger.log('ProxyObject.checkState(): count= "'+e+'". (iid: '+n.iid+" oid: "+n.oid+")"),n.checkState(--e,t))},t)},e.prototype.waitUntilConnected=function(e){var t=this;return new Promise(function(n,o){i.logger.trace("ProxyObject.waitUntilConnected(): readyState="+t.state+". (iid: "+t.iid+" oid: "+t.oid+")"),t.state==l.Destroyed&&(t.onConnected(),o("Object already destroyed :"+t.user_friendly_id())),t.state==l.Configured?(t.onConnected(),n()):t.state==l.Error?(i.logger.trace("ProxyObject.waitUntilConnected(): readyState="+t.state+". (iid: "+t.iid+" oid: "+t.oid+")"),t.onConnected(),o()):(i.logger.log('ProxyObject.waitUntilConnected(): deferring action "'+e+'". (iid: '+t.iid+" oid: "+t.oid+")"),t.deferredActions.push(new s(n,o,e)),t.checkState(15,1e3))})},e.prototype.remoteInvoke=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return this.state==l.Destroyed?Promise.reject("Cannot invoke destroyed object :"+this.user_friendly_id()):this.state==l.Error?Promise.reject("Cannot invoke object in Error state:"+this.user_friendly_id()):(i=a.WebrpcClassLibInfoUtil.getMethodFeatureByid(this.iid,t),this.hdxms.WSSendObjectWrapper(i,this.iid,t,o.WsJsonUtil.createMessageByid.apply(o.WsJsonUtil,[e,!1,o.ws_msg_type_t.req,this.iid,t,this.oid].concat(n))))},e.prototype.registerCallbacks=function(t,n,i){this.unregisterCallbacks(i);var o=e.nextcbid++,r=new d(o,n,t);return n||(t||this.cbs.set(i,o),this.hdxms.registerHandler(this.iid,this.oid,r)),r},e.prototype.unregisterCallbacks=function(e){this.cbs.has(e)?(this.hdxms.unregisterHandler(this.iid,this.oid,this.cbs.get(e)),this.cbs.delete(e)):(i.logger.log("ProxyObject: Cant find callback handler registration for mid: "+e),i.logger.trace(this.cbs))},e.prototype.object_id=function(){return this.oid},e.prototype.param0=function(e){return e.params[0]},e.prototype.isNullCallback=function(e){return void 0==e||null==e},e.prototype.user_friendly_id=function(){return this.constructor.name+"["+this.oid+"]"},e.prototype.isRedirected=function(){return this.hdxms.isRedirected()},e.prototype.isValid=function(){return!(this.state===l.Error||this.state===l.Destroyed)},e.prototype.registerStateChangeNotification=function(e){this.hdxms.registerStateChangeNotification(e)},e.prototype.unregisterStateChangeNotification=function(e){this.hdxms.unregisterStateChangeNotification(e)},e.nextId=0,e.nextcbid=0,e}(),t.ProxyObject=e}),define("telemetry",["require","exports","hdxms","logger"],function(e,t,n,i){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.unknown=0]="unknown",e[e.active=1]="active",e[e.idle=2]="idle"}(t.tel_CallState||(t.tel_CallState={})),function(e){e[e.unknown=0]="unknown",e[e.incoming=1]="incoming",e[e.outgoing=2]="outgoing"}(t.tel_CallDirection||(t.tel_CallDirection={})),function(e){e[e.unknown=0]="unknown",e[e.audio=1]="audio",e[e.video=2]="video",e[e.multi=3]="multi",e[e.dshare=4]="dshare"}(t.tel_CallType||(t.tel_CallType={}));var o;!function(e){e[e.Unknown=0]="Unknown",e[e.Cap=1]="Cap",e[e.Init=2]="Init",e[e.Data=3]="Data"}(o=t.tel_cmd||(t.tel_cmd={})),t.tel_key_ConferenceCallDuration="ConferenceCallDuration",t.tel_key_AudioCallDuration="AudioCallDuration",t.tel_key_VideoCallDuration="VideoCallDuration",t.tel_key_ScreensharingCallDuration="ScreensharingCallDuration",t.tel_key_CallEstIncoming="CallEstIncoming",t.tel_key_CallEstOutgoing="CallEstOutgoing",t.tel_key_AudioDeviceUsed="AudioDeviceUsed",t.tel_key_VideoDeviceUsed="VideoDeviceUsed",t.tel_key_SpeakerDeviceUsed="SpeakerDeviceUsed",t.tel_key_PerfCallDirection="PerfCallDirection",t.tel_key_PerfCallState="PerfCallState",t.tel_key_PerfCallType="PerfCallType",t.tel_key_VerWebrpc="VerWebrpc",t.tel_key_VerWebrtcCodecs="VerWebrtcCodecs",t.tel_key_VerReceiver="VerReceiver",t.tel_key_VerVda="VerVda",t.tel_key_VerEndpoint="VerEndpoint",t.tel_key_VerTypeScript="VerTypeScript";var r=function(){function e(e,t,n,i){this.cmd=e,this.key=t,this.value=n,this.flags=i}return e.prototype.SendTelemetryData=function(e){e.SendTelemetryData(this.cmd,this.key,this.value,this.flags)},e}();e=function(){function e(){this.id=0,this.deferredData=[]}return e.prototype.reset=function(){this.id=0,this.deferredData=[]},e.prototype.onInitialized=function(e){for(this.id=e;this.deferredData&&0<this.deferredData.length;)this.deferredData.shift().SendTelemetryData(this)},e.prototype.SendTelemetryInit=function(){0<this.id&&this.reset();try{n.getRedirector().WSSendObject({v:"telemetry",hdr:{command:o.Init,id:0},init:{domain:"HDX Domain Multimedia Teams",subdomain:"Teams",feature:"msteams",version:"1.1.1.1"}})}catch(e){i.logger.log(e)}},e.prototype.SendTelemetryData=function(e,t,a,s){if(e!=o.Data)i.logger.log("invalid telemetry command!");else if(0==this.id)this.deferredData.push(new r(e,t,a,s));else try{n.getRedirector().WSSendObject({v:"telemetry",hdr:{command:e,id:this.id},data:{key:t,value:a,flags:s}})}catch(e){i.logger.log(e)}},e}(),t.Telemetry=e}),define("hdxms","require exports proxyobject logger webrpcclassinfo wsjsonutil telemetry".split(" "),function(e,t,n,i,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});var s,c=function(e,t,n,i,o,r,a){this.resolve=e,this.reject=t,this.iid=n,this.oid=i,this.cbid=o,this.oneShot=r,this.mid=a};!function(e){e[e.NotRedirected=0]="NotRedirected",e[e.Connecting=1]="Connecting",e[e.Binding=2]="Binding",e[e.Redirected=3]="Redirected"}(s=t.RedirectionStatus||(t.RedirectionStatus={})),e=function(){function e(){this.pingactive=!1,this.status=s.NotRedirected,this.reqs=[],this.cbs=[],this.deferredActions=[],this.telemetry_=new a.Telemetry,this.stateChangeNotifcations=[]}return Object.defineProperty(e.prototype,"telemetry",{get:function(){return this.telemetry_},enumerable:!0,configurable:!0}),e.prototype.setRemoteSessionInfoCb=function(e){this.remoteSessionInfoCb=e},e.prototype.setFeatures=function(e){this.features=e},e.prototype.getFeatureValue=function(e){var t=this.features.find(function(t){return t.name===e});return void 0!==t&&t.value},e.prototype.onRedirectionComplete=function(){for(;this.deferredActions&&0<this.deferredActions.length;)this.deferredActions.shift().post(this.status==s.Redirected)},e.prototype.connectToService=function(){return i.logger.log("Redirection status: Connecting..."),this.status=s.Connecting,new Promise(function(e,t){var n=new WebSocket("wss://127.0.0.1:9002");n.onopen=function(){e(n)},n.onerror=function(e){i.logger.log("websocket connection error: "+e.type),t(e)}})},e.prototype.waitUntilRedirected=function(e){var t=this;return new Promise(function(n,o){t.status==s.Redirected?n():0>=e?o():setTimeout(function(){i.logger.log("waitUntilRedirected() timeout. count="+e),t.status!=s.Redirected?t.waitUntilRedirected(--e).then(function(){n()}).catch(function(){o()}):n()},2e3)})},e.prototype.handleRemoteSessionInfo=function(){var e=this;i.logger.log("handleRemoteSessionInfo called.");var t=this;t.remoteSessionInfoCb?t.remoteSessionInfoCb().then(function(n){i.logger.log("remoteSessionInfo success! info:"+JSON.stringify(n)),i.logger.log("Redirection status: Redirected"),t.status=s.Redirected,t.pingConnectionEnd(),(0,window.onVdiClientConnected)(),e.telemetry.SendTelemetryInit(),t.onRedirectionComplete()}).catch(function(){i.logger.log("remoteSessionInfo failure!"),t.suspendRedirection(!0),t.onRedirectionComplete()}):(i.logger.log("remoteSessionInfoCb is invalid!"),t.suspendRedirection(!0),t.onRedirectionComplete())},e.prototype.startRedirection=function(e,t){var o=this,r=window.onVdiClientDisconnected;return new Promise(function(a,c){o.status!=s.Redirected?(i.logger.log("Attempting to start redirection: "+t),!1===e?o.deferredActions.push(new n.deferred_action(a,c,t)):o.connectToService().then(function(e){i.logger.log("Redirection status: Binding..."),o.status=s.Binding,o.websocket=e,o.websocket.onmessage=function(e){o.onWSMessage(e)},o.websocket.onclose=function(e){o.onWSClose(e)},a(),o.handleRemoteSessionInfo()}).catch(function(e){i.logger.log("Unable to connect to websocket service!"),c(),o.suspendRedirection(!0),o.onRedirectionComplete(),r(!0)})):(i.logger.log("Redirection already started."),a())})},e.prototype.suspendRedirection=function(e){var t=this;i.logger.log("Suspending redirection."),(0,window.onVdiClientDisconnected)(!1);var n=!1;(0,window.getCitrixMSTeamsRedir)().then(function(e){i.logger.log("sucesss on disconnect"+e),1==e&&""!==e&&(n=!0,i.logger.log("Reg key exists while disconnecting")),t.status===s.Redirected&&1==n&&(i.logger.log("Calling ping not normal disconnect"),t.pingConnectionBegin(!1)),i.logger.log("Redirection status: NotRedirected"),t.status=s.NotRedirected}),this.dispatchStateChangeNotifications()},e.prototype.onWSOpen=function(){},e.prototype.onWSClose=function(e){i.logger.log("disconnected from websocket service.");try{this.suspendRedirection(!0)}catch(e){i.logger.log("suspendRedirection(): exception closing WebSocket: "+e.message)}},e.prototype.onWSError=function(){try{this.suspendRedirection(!0)}catch(e){i.logger.log("suspendRedirection(): exception on WebSocket error: "+e.message)}},e.prototype.WSSendObjectWrapper=function(e,t,n,i){a=!0;t!=o.class_id_t.EngineControl||n!=o.method_id_EngineControl_t.ctor&&n!=o.method_id_EngineControl_t.version&&n!=o.method_id_EngineControl_t.feature_flags||(a=!1);var r=!0;if(a&&(r=!1,void 0!=this.features))for(var a=0,s=this.features;a<s.length;a++){var c=s[a];if(!0===c.value&&c.name==e){r=!0;break}}return 1==r?this.WSSendObject(i):Promise.reject("Cannot invoke method that is not supported by webrpc: iid("+t+") mid("+n+")")},e.prototype.WSSendObject=function(e){var t=this;return new Promise(function(n,r){if("webrtc"==e.v){var a=e.hdr.proc.iid,s=e.hdr.proc.methodid,d=e.objref.oid,l=e.hdr.destroy;e.hdr.modifier||l||(a=new c(n,r,a,d,0,!0,s),t.reqs.push(a)),a=JSON.stringify(e),i.logger.trace("WSSendObject: >>> "+o.WebrpcClassLibInfoUtil.composeClassInfoData(e)+" "+a);try{t.websocket.send(a)}catch(e){i.logger.log("WSSendObject(): exception: "+e.message),r(e.message)}}else"overlay"==e.v?(a=JSON.stringify(e),i.logger.log("HDXMS: SendOverlayData: >>> "+a+"'"),t.websocket.send(a)):"telemetry"==e.v?(a=JSON.stringify(e),i.logger.log("HDXMS: SendTelemetryData: >>> "+a+"'"),t.websocket.send(a)):i.logger.log("HDXMS: Unknown protocol: '"+JSON.stringify(e)+"'")})},e.prototype.onWSMessage=function(e){var t,n=e.data;try{t=JSON.parse(n)}catch(e){console.log("invalid JSON!!!"),console.log(e),console.log(n)}if("webrtc"==t.v){i.logger.trace("onWSMessage: <<< "+o.WebrpcClassLibInfoUtil.composeClassInfoData(t)+" "+n);var a=t.hdr.proc.iid,s=t.hdr.proc.methodid,c=t.objref.oid;if(e=t.status,t.hdr.msg_type==r.WsJsonUtil.getMsgType(r.ws_msg_type_t.reply))0<=(n=this.reqs.findIndex(function(e){return e.iid==a&&e.oid==c&&e.mid==s}))?0==e?this.reqs.splice(n,1).shift().resolve(t):this.reqs.splice(n,1).shift().reject():(i.logger.log("HDXMS didnt find this one. (reqs)"),i.logger.log(this.reqs));else if(t.hdr.msg_type==r.WsJsonUtil.getMsgType(r.ws_msg_type_t.event_req)){var d=t.func.id;0<=(n=this.cbs.findIndex(function(e){return e.iid==a&&e.oid==c&&e.cbid==d>>16}))?(0==(65535&d)?this.cbs[n].resolve(t):this.cbs[n].reject(),1==this.cbs[n].oneShot&&this.cbs.splice(n,1)):(i.logger.log("HDXMS didnt find this one. (cbs)"),i.logger.log(this.cbs))}else i.logger.log("HDXMS Received bogus message: "+n+"'")}else"telemetry"==t.v?0==t.status&&2==(2147483647&t.hdr.command)&&(this.telemetry.onInitialized(t.hdr.id),i.logger.log("Telemetry init response received")):i.logger.log("HDXMS: Unknown protocol: "+n+"'")},e.prototype.clearReqs=function(){i.logger.log("clearReqs()"),this.reqs.forEach(function(e,t){e.reject()}),this.reqs=[]},e.prototype.registerHandler=function(e,t,n){e=new c(n.resolve.bind(n),n.reject.bind(n),e,t,n.id,n.oneShot,0),this.cbs.push(e)},e.prototype.unregisterHandler=function(e,t,n){var o=this.cbs.findIndex(function(i){return i.iid==e&&i.oid==t&&i.cbid==n});0<=o?this.cbs.splice(o,1):(i.logger.log("HDXMS Didnt find this callback in the list!"),console.log(this.cbs))},e.prototype.isRedirected=function(){return this.status===s.Redirected||this.status===s.Binding||this.status===s.Connecting},e.prototype.isPingActive=function(){return this.pingactive},e.prototype.pingConnectionBegin=function(e){i.logger.log("Started timer"),this.pingactive=!0;var t=window.onVdiClientDisconnectedTimer;1==e?(i.logger.log("checking if we are connected..."),t()):this.conntimer=setTimeout(function(){i.logger.log("checking if we are connected..."),t()},15e3)},e.prototype.pingConnectionEnd=function(){this.pingactive=!1,clearTimeout(this.conntimer)},e.prototype.SendTelemetryData_Speaker=function(e){this.telemetry.SendTelemetryData(a.tel_cmd.Data,a.tel_key_SpeakerDeviceUsed,e,1)},e.prototype.registerStateChangeNotification=function(e){this.stateChangeNotifcations.push(e)},e.prototype.unregisterStateChangeNotification=function(e){this.stateChangeNotifcations=this.stateChangeNotifcations.filter(function(t){return t!=e})},e.prototype.dispatchStateChangeNotifications=function(){this.stateChangeNotifcations.forEach(function(e){e()})},e}(),t.HdxMediaStream=e;var d=new e;t.getRedirector=function(){return d}}),define("remotemedia","require exports webrpcclassinfo proxyobject logger hdxms telemetry".split(" "),function(e,t,n,i,o,r,a){Object.defineProperty(t,"__esModule",{value:!0});var s;t.enumerateddecices=s;var c=function(e,t){this.type=e,this.target=t},d=function(){function e(){this.is_local_clone=!1,this.clone_id=this.clone_count=0}return e.prototype.clone=function(){this.clone_count++;var t=new e;return t.is_local_clone=!0,t.clone_id=this.clone_count,t},e.prototype.synchronize=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.is_local_clone?[2,e.asyncClone()]:[2,e]})})},e}(),l=function(e){function t(t,i){var o=e.call(this,t,n.class_id_t.MediaStreamTrack,i,!0)||this;return o.refCount_=0,o.refCount_++,o.clone_state=new d,o}return __extends(t,e),Object.defineProperty(t.prototype,"refcount",{get:function(){return this.refCount_},enumerable:!0,configurable:!0}),t.prototype.addRef=function(){this.refCount_++,o.logger.log(this.user_friendly_id()+".addRef() called. [id="+this.id+"] refcount="+this.refCount_)},Object.defineProperty(t.prototype,"onended",{get:function(){return o.logger.log(this.user_friendly_id()+".get_onended() called. [id="+this.id+"]"),this.onended_},set:function(e){var t=this;o.logger.log(this.user_friendly_id()+".set_onended() called. [id="+this.id+"]"),this.onended_=e,this.waitUntilConnected("MediaStreamTrack.onended").then(function(){var i=t.registerCallbacks(!1,t.isNullCallback(e),n.method_id_MediaStreamTrack_t.onended);return i.then(function(e){o.logger.log(t.user_friendly_id()+"onended event received!!!"),e=new c("ended",t),t.readyState_="ended",t.onended_(e)}),t.remoteInvoke(!0,n.method_id_MediaStreamTrack_t.onended,i.success)}).catch(function(){o.logger.log(t.user_friendly_id()+".onended failed!!!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onmute",{get:function(){return o.logger.log(this.user_friendly_id()+".get_onmute() called. [id="+this.id+"]"),this.onmute_},set:function(e){var t=this;o.logger.log(this.user_friendly_id()+".set_onmute() called. [id="+this.id+"]"),this.onmute_=e,this.waitUntilConnected("MediaStreamTrack.onmute").then(function(){var i=t.registerCallbacks(!1,t.isNullCallback(e),n.method_id_MediaStreamTrack_t.onmute);return i.then(function(e){o.logger.log(t.user_friendly_id()+"onmute event received!!!"),e=new c("mute",t),t.muted=!0,t.onmute_(e)}),t.remoteInvoke(!0,n.method_id_MediaStreamTrack_t.onmute,i.success)}).catch(function(){o.logger.log(t.user_friendly_id()+".onmute failed!!!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onunmute",{get:function(){return o.logger.log(this.user_friendly_id()+".get_onunmute() called. [id="+this.id+"]"),this.onunmute_},set:function(e){var t=this;o.logger.log(this.user_friendly_id()+".set_onunmute() called. [id="+this.id+"]"),this.onunmute_=e,this.waitUntilConnected("MediaStreamTrack.onunmute").then(function(){var i=t.registerCallbacks(!1,t.isNullCallback(e),n.method_id_MediaStreamTrack_t.onunmute);return i.then(function(e){o.logger.log("onunmute event received!!!"),e=new c("unmute",t),t.muted=!1,t.onunmute_(e)}),t.remoteInvoke(!0,n.method_id_MediaStreamTrack_t.onunmute,i.success)}).catch(function(){o.logger.log(t.user_friendly_id()+".onunmute failed!!!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onstop",{set:function(e){this.onstop_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enabled",{get:function(){return o.logger.log(this.user_friendly_id()+".get_enabled() called. [id="+this.id+", value="+this.enabled_+"]"),this.enabled_},set:function(e){o.logger.log(this.user_friendly_id()+".set_enabled() called. [id="+this.id+", value="+e+"]"),this.enabled_=e,this.remoteInvoke(!0,n.method_id_MediaStreamTrack_t.enabled,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return o.logger.log(this.user_friendly_id()+".get_readyState() called. [id="+this.id+"]"),this.readyState_},enumerable:!0,configurable:!0}),t.prototype.asyncClone=function(){return __awaiter(this,void 0,void 0,function(){var e,i,o;return __generator(this,function(r){switch(r.label){case 0:return[4,this.waitUntilConnected("RemoteMediaTrack.asyncClone")];case 1:return r.sent(),[4,this.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.clone,[])];case 2:return e=r.sent(),i=this.param0(e),o=new t(this,i.oid),[2,o.syncBarrier()]}})})},t.prototype.clone=function(){o.logger.log(this.user_friendly_id()+".clone() called. [id="+this.id+"]");var e=this.clone_state.clone(),n=new t(this,this.object_id());return n.id=this.id+"."+e.clone_id.toString(),n.label=this.label,n.kind=this.kind,n.enabled_=this.enabled_,n.muted=this.muted,n.readyState_=this.readyState_,n.trackSettings_=this.trackSettings_,n.clone_state=e,n},t.prototype.stop=function(){var e=this;o.logger.log(this.user_friendly_id()+".stop() called. [id="+this.id+"] refcount="+this.refCount_),this.readyState_="ended",0<this.refCount_&&0==--this.refCount_&&(o.logger.log(this.user_friendly_id()+".stop() called. [id="+this.id+"] remote invoking..."),this.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.stop).catch(function(t){o.logger.log(e.user_friendly_id()+".stop() failed with:"+t)}),null!==this.onstop_)&&this.onstop_()},t.prototype.getCapabilities=function(){o.logger.log(this.user_friendly_id()+".getCapabilities() called. [id="+this.id+"]")},t.prototype.getConstrains=function(){o.logger.log(this.user_friendly_id()+".getConstrains() called. [id="+this.id+"]")},t.prototype.getSettings=function(){return"audio"==this.kind?function(e){return{deviceId:e.deviceId,echoCancellation:e.echoCancellation}}(this.trackSettings_):function(e){return{aspectRatio:e.aspectRatio,deviceId:e.deviceId,frameRate:e.frameRate,height:e.height,width:e.width}}(this.trackSettings_)},t.prototype.applyConstraints=function(e){var t=this;return o.logger.log("MediaStreamTrack.applyConstraints() called."),new Promise(function(i,o){t.waitUntilConnected("MediaStreamTrack.applyConstraints").then(function(){return t.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.applyConstraints,e)}).then(function(){i()}).catch(function(){o({name:"OverconstrainedError",message:"Failed to apply constraints."})})})},t.convertReadyState=function(e){return 0==e?"live":"ended"},t.prototype.syncBarrier=function(){var e=this;return o.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(i,o){e.waitUntilConnected("MediaStreamTrack.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.kind,""),e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.id,""),e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.label,""),e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.enabled,!1),e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.muted,!1),e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.readyState,0),e.remoteInvoke(!1,n.method_id_MediaStreamTrack_t.getSettings)])}).then(function(n){var o=0;n=n.map(function(t){return e.param0(t)}),e.kind=n[0],e.id=n[1],e.label=n[2],e.enabled_=n[3],e.muted=n[4],o=n[5],e.trackSettings_=n[6],e.readyState_=t.convertReadyState(o),i(e)}).catch(function(){o()})})},t}(i.ProxyObject);t.RemoteMediaTrack=l;var u=function(){},g=function(e){function t(t,i){var o=e.call(this,t,n.class_id_t.MediaStream,i,!0)||this;return o.clone_state=new d,o}return __extends(t,e),t.prototype.dumpTrackInfo=function(){o.logger.log(this.user_friendly_id()+".dumpTrackInfo() called. [id="+this.id+"]");for(var e=0,t=this.tracks_;e<t.length;e++){var n=t[e];o.logger.log(n.user_friendly_id()+" [id="+n.id+"] refcount="+n.refcount)}},t.prototype.toJSON=function(){var e=new u;return e.id=this.id,e.active=this.active,e.oid=this.object_id(),"RemoteStream:"+JSON.stringify(e)},t.prototype.getAudioTracks=function(){o.logger.log(this.user_friendly_id()+".getAudioTracks() called. [id="+this.id+"]");for(var e=[],t=0,n=this.tracks_;t<n.length;t++){var i=n[t];"audio"==i.kind&&e.push(i)}return e},t.prototype.getVideoTracks=function(){o.logger.log(this.user_friendly_id()+".getVideoTracks() called. [id="+this.id+"]");for(var e=[],t=0,n=this.tracks_;t<n.length;t++){var i=n[t];"video"==i.kind&&e.push(i)}return e},t.prototype.getTracks=function(){return o.logger.log(this.user_friendly_id()+".getTracks() called. [id="+this.id+"]"),this.tracks_},t.prototype.getTrackById=function(e){o.logger.log(this.user_friendly_id()+".getTrackById() called. [id="+this.id+"]");for(var t=0,n=this.tracks_;t<n.length;t++){var i=n[t];if(i.id==e)return i}},t.prototype.addTrack=function(e){o.logger.log(this.user_friendly_id()+".addTrack() called. [id="+this.id+"]"),this.tracks_.push(e),this.remoteInvoke(!1,n.method_id_MediaStream_t.addTrack,{oid:e.object_id()})},t.prototype.removeTrack=function(e){o.logger.log(this.user_friendly_id()+".removeTrack() called. [id="+this.id+"]");var t=this.tracks_.indexOf(e);this.tracks_.splice(t,1),this.remoteInvoke(!1,n.method_id_MediaStream_t.removeTrack,{oid:e.object_id()})},t.prototype.asyncClone=function(){return __awaiter(this,void 0,void 0,function(){var e,i,r;return __generator(this,function(a){switch(a.label){case 0:return o.logger.log(this.user_friendly_id()+".asyncClone() called. [id="+this.id+"]"),[4,this.waitUntilConnected("asyncClone")];case 1:return a.sent(),[4,this.remoteInvoke(!1,n.method_id_MediaStream_t.clone,[])];case 2:return e=a.sent(),console.log(e),i=this.param0(e),r=new t(this,i.oid),[2,r.syncBarrier()]}})})},t.prototype.clone=function(){o.logger.log(this.user_friendly_id()+".clone() called. [id="+this.id+"]");var e=this.clone_state.clone(),n=new t(this,this.object_id());return n.id=this.id+"."+e.clone_id.toString(),this.tracks_.forEach(function(e){e.addRef()}),n.tracks_=this.tracks_,n.clone_state=e,n},t.prototype.syncBarrier=function(){var e=this;return o.logger.log(this.user_friendly_id()+".syncBarrier() called. [id="+this.id+"]"),new Promise(function(t,i){e.waitUntilConnected("MediaStream.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,n.method_id_MediaStream_t.id,""),e.remoteInvoke(!1,n.method_id_MediaStream_t.active,!1),e.remoteInvoke(!1,n.method_id_MediaStream_t.getTracks,[])])}).then(function(t){t=t.map(function(t){return e.param0(t)}),e.id=t[0],e.active=t[1],t=t[2];for(var n=[],i=0;i<t.length;i++){var o=new l(e,t[i].oid);n.push(o.syncBarrier())}return Promise.all(n)}).then(function(n){e.tracks_=[],n.forEach(function(t){t.onstop=function(){var t=!0;e.tracks_.forEach(function(e){"ended"!=e.readyState&&(t=!1)}),t&&e.release()},e.tracks_.push(t)}),t(e)}).catch(function(){i()})})},t}(i.ProxyObject);t.RemoteStream=g,e=function(e){function t(t,i){return e.call(this,t,n.class_id_t.MediaStreamEvent,i,!0)||this}return __extends(t,e),t.prototype.syncBarrier=function(){var e=this;return o.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,i){e.waitUntilConnected("MediaStreamEvent.syncBarrier").then(function(){return e.remoteInvoke(!1,n.method_id_MediaStreamEvent_t.stream,{oid:0})}).then(function(t){return new g(e,t.params[0].oid).syncBarrier()}).then(function(n){e.stream=n,t(e)}).catch(function(){i()})})},t}(i.ProxyObject),t.RemoteStreamEvent=e;var h=function(e){function t(t){return e.call(this,null,n.class_id_t.MediaDeviceInfo,t,!0)||this}return __extends(t,e),t.prototype.convertKind=function(e){return 0==e?"audioinput":1==e?"audiooutput":"videoinput"},t.prototype.syncBarrier=function(){var e=this;return o.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,i){e.waitUntilConnected("RemoteDeviceInfo.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,n.method_id_MediaDeviceInfo_t.deviceId,""),e.remoteInvoke(!1,n.method_id_MediaDeviceInfo_t.kind,0),e.remoteInvoke(!1,n.method_id_MediaDeviceInfo_t.label,""),e.remoteInvoke(!1,n.method_id_MediaDeviceInfo_t.groupId,"")])}).then(function(n){e.kind=e.convertKind(e.param0(n.splice(1,1)[0])),n=n.map(function(t){return e.param0(t)}),e.deviceId=n[0],e.label=n[1],e.groupId=n[2],t(e)}).catch(function(){o.logger.log(e.user_friendly_id()+".syncBarrier(): rejected."),i()})})},t}(i.ProxyObject);t.RemoteDeviceInfo=h,e=function(e){function i(){var t=e.call(this,null,n.class_id_t.MediaDevices,0,!1,function(){t.setDeviceChangeCallback()})||this;return t.devices_=[],t}return __extends(i,e),i.prototype.enumerateDevices=function(){var e=this;return o.logger.log(this.user_friendly_id()+".enumerateDevices() called"),new Promise(function(i,r){e.waitUntilConnected("RemoteDevices.enumerateDevices").then(function(){return o.logger.log(e.user_friendly_id()+".enumerateDevices() remote invoking..."),e.remoteInvoke(!1,n.method_id_MediaDevices_t.enumerateDevices,[])}).then(function(t){var n=[];return t.params[0].forEach(function(t){var i=e.devices_.find(function(e){return e.object_id()===t.oid});void 0===i?(i=new h(t.oid),n.push(i.syncBarrier())):n.push(i)}),Promise.all(n)}).then(function(n){o.logger.log(e.user_friendly_id()+".enumerateDevices: returning enumerated devices with ids ["+n.map(function(e){return e.object_id()})+"]"),i(n),o.logger.log(e.user_friendly_id()+".enumerateDevices: resolved promise"),e.devices_.forEach(function(e){for(var t=!0,i=0;i<n.length;i++)if(e===n[i]){t=!1;break}t&&e.release()}),e.devices_=n,t.enumerateddecices=s=n}).catch(function(){o.logger.log(e.user_friendly_id()+".enumerateDevices() didnt get response, resolving with empty list"),e.devices_=[],i([])})})},i.prototype.getDisplayMedia=function(e){var t=this;return new Promise(function(i,r){t.waitUntilConnected("RemoteDevices.getDisplayMedia").then(function(){var i=t.prepareDisplayConstraints(e);return t.remoteInvoke(!1,n.method_id_MediaDevices_t.getDisplayMedia,i)}).then(function(e){return new g(null,e.params[0].oid).syncBarrier()}).then(function(e){i(e)}).catch(function(){o.logger.log(t.user_friendly_id()+".getDisplayMedia() returned an error."),r(new DOMException("Unable to get a display stream.","NotReadableError"))})})},i.prototype.setDeviceChangeCallback=function(){var e=this;o.logger.log(this.user_friendly_id()+".set_DeviceChangeCallback() called."),this.waitUntilConnected("MediaDevices.ondevicechange").then(function(){var t=e.registerCallbacks(!1,!1,n.method_id_MediaDevices_t.ondevicechange);return t.then(function(){o.logger.log(e.user_friendly_id()+".ondevicechange(): callback received!!!"),navigator.mediaDevices.dispatchEvent(new CustomEvent("devicechange"))}),e.remoteInvoke(!0,n.method_id_MediaDevices_t.ondevicechange,t.success)}).catch(function(){o.logger.log(e.user_friendly_id()+".set_ondevicechange(): failed.")})},i.prototype.prepareDisplayConstraints=function(e){if(r.getRedirector().getFeatureValue(n.FEATURE_ms_teams_common_media_constraints))return e;var t={frameRate:15,width:{max:1920},height:{max:1080}};return void 0!==e.video&&null!==e.video&&void 0!==(e=e.video).frameRate&&void 0!==e.width&&void 0!==e.height&&(t.frameRate=e.frameRate,t.width.max=e.width.max||e.width,t.height.max=e.height.max||e.height),{video:t}},i}(i.ProxyObject),t.RemoteDevices=e,i=function(e){function t(){return e.call(this,null,n.class_id_t.NavigatorUserMedia,0,!1)||this}return __extends(t,e),t.prototype.webkitGetUserMedia=function(e,t,n){this.getUserMedia(e,t,n)},t.prototype.LogTelemetryDevice_=function(e){try{if(void 0!==e.audio){var t,n=e.audio.deviceId;s.forEach(function(e){n==e.deviceId&&(t=e.label)}),o.logger.log(t),this.SendTelemetryData(a.tel_key_AudioDeviceUsed,t,0)}if(void 0!==e.video){var i,r=e.video.mandatory.sourceId;s.forEach(function(e){r==e.deviceId&&(i=e.label)}),o.logger.log(i),this.SendTelemetryData(a.tel_key_VideoDeviceUsed,i,0)}}catch(e){o.logger.log(e)}},t.prototype.getUserMedia=function(e,t,i){var r=this;o.logger.log(this.user_friendly_id()+".getUserMedia() called: "+JSON.stringify(e)),this.waitUntilConnected("NavigatorUserMedia.getUserMedia").then(function(){var t=r.registerCallbacks(!0,!1,n.method_id_NavigatorUserMedia_t.getUserMedia);if(void 0!==e.audio&&0==Object.keys(e.audio).length&&(e.audio={dummy:1}),void 0!==e.video){var i=e.video;void 0==i.mandatory.maxFrameRate&&(i.mandatory.maxFrameRate=30),void 0==i.mandatory.minWidth&&(i.mandatory.minWidth=360),void 0==i.mandatory.maxWidth&&(i.mandatory.maxWidth=1920),void 0==i.mandatory.minHeight&&(i.mandatory.minHeight=180),void 0==i.mandatory.maxHeight&&(i.mandatory.maxHeight=1080)}return r.remoteInvoke(!1,n.method_id_NavigatorUserMedia_t.getUserMedia,e,t.success,t.fail),t.prom()}).then(function(e){return o.logger.log(r.user_friendly_id()+".getUserMedia: received success callback!"),new g(null,r.param0(e).oid).syncBarrier()}).then(function(n){o.logger.log(r.user_friendly_id()+".getUserMedia: MediaStream ready to deliver",JSON.stringify(n)),0==n.getTracks().length?(o.logger.log(r.user_friendly_id()+".getUserMedia: reporting no tracks as error."),i({constraintName:"",name:"ConstraintNotSatisfiedError",message:""})):(r.LogTelemetryDevice_(e),t(n))}).catch(function(e){o.logger.log(e),i({constraintName:"",name:"ConstraintNotSatisfiedError",message:""})})},t.prototype.SendTelemetryData=function(e,t,n){r.getRedirector().telemetry.SendTelemetryData(a.tel_cmd.Data,e,t,n)},t}(i.ProxyObject),t.NavigatorUserMedia=i}),define("rtpsender",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){};t.RtpSender=n}),define("map",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),define("stats",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.items=[]}return e.fromJSON=function(t){for(var n=new e,o=0;o<t.length;o++){var r=i.fromJSON(t[o]);n.items.push(r)}return n},e.prototype.toJSON=function(){return JSON.stringify(this.items)},e.prototype.result=function(){return this.items},e}();t.StatsReport=n;var i=function(){function e(){this.names_=[],this.stat_=new Map,this.id="",this.timestamp=0,this.type=""}return e.fromJSON=function(t){var n=new e;return n.id=t.id||"",n.timestamp=t.timestamp||"",n.type=t.type||"",Object.keys(t).forEach(function(e){"id"!==e&&"timestamp"!==e&&"type"!==e&&(n.names_.push(e),n.stat_.set(e,t[e]))}),n},e.prototype.toJSON=function(){return JSON.stringify({id:this.id,timestamp:this.timestamp,type:this.type,stat:this.stat_})},e.prototype.names=function(){return this.names_},e.prototype.stat=function(e){return this.stat_.get(e)},e}();t.Stats=i}),define("peerconnection","require exports hdxms remotemedia proxyobject webrpcclassinfo logger stats telemetry".split(" "),function(e,t,n,i,o,r,a,s,c){Object.defineProperty(t,"__esModule",{value:!0});var d=function(e){function t(t,n,i){return t=e.call(this,t,r.class_id_t.RTCIceCandidateEvent,n,!0)||this,t.target=i,t.type="icecandidate",t}return __extends(t,e),Object.defineProperty(t.prototype,"candidate",{get:function(){return this.candidate_},enumerable:!0,configurable:!0}),t.prototype.syncBarrier=function(){var e=this;return a.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.waitUntilConnected("IceCandidateEvent.syncBarrier").then(function(){return e.remoteInvoke(!1,r.method_id_RTCIceCandidateEvent_t.candidate,{oid:0})}).then(function(t){return!1===(t=e.param0(t)).is_null?new l(e,t.oid).syncBarrier():Promise.resolve(null)}).then(function(n){a.logger.log(e.user_friendly_id()+".onicecandidate: icecandidate available!"),e.candidate_=n,t(e)}).catch(function(){a.logger.log(e.user_friendly_id()+".onicecandidate() failed."),n()})})},t}(o.ProxyObject);t.IceCandidateEvent=d;var l=function(e){function t(t,n){return e.call(this,t,r.class_id_t.RTCIceCandidate,n,!0)||this}return __extends(t,e),Object.defineProperty(t.prototype,"candidate",{get:function(){return this.candidate_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sdpMid",{get:function(){return this.sdpMid_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sdpMLineIndex",{get:function(){return this.sdpMLineIndex_},enumerable:!0,configurable:!0}),t.prototype.syncBarrier=function(){var e=this;return a.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.waitUntilConnected("IceCandidate.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,r.method_id_RTCIceCandidate_t.candidate,""),e.remoteInvoke(!1,r.method_id_RTCIceCandidate_t.sdpMid,""),e.remoteInvoke(!1,r.method_id_RTCIceCandidate_t.sdpMLineIndex,0)])}).then(function(n){n=n.map(function(t){return e.param0(t)}),e.candidate_=n[0],e.sdpMid_=n[1],e.sdpMLineIndex_=n[2],t(e)}).catch(function(){n()})})},t}(o.ProxyObject);t.IceCandidate=l;var u=function(){function e(e){this.state_="new",this.candidates_=[],this.pc_=e}return e.prototype.pushState=function(e){a.logger.log(this.pc_.user_friendly_id()+".onicegatheringstatechange: new state is "+e),this.state_=e,"gathering"==this.state_?(this.candidates_=[],this.postUpdate()):this.processRemaining()},e.prototype.addIceCandidate=function(e){var t=this;this.candidates_.push(e),e.syncBarrier().then(function(e){return a.logger.log(t.pc_.user_friendly_id()+".onicecandidate: icecandidate available!"),Promise.all([t.pc_.updateLocalDescription(),Promise.resolve(e)])}).then(function(e){t.postIceCandidate(e[1])})},e.prototype.postIceCandidate=function(e){a.logger.log(this.pc_.user_friendly_id()+".onicecandidate: posting ice candidate now!"),null!=this.pc_.onicecandidate?this.pc_.onicecandidate(e):a.logger.log(this.pc_.user_friendly_id()+"onicecandidate is NULL!!!"),this.candidates_.shift(),this.processRemaining()},e.prototype.postUpdate=function(){a.logger.log(this.pc_.user_friendly_id()+".onicegatheringstatechange: posting event now!");var e=new h("onicegatheringstatechange",this.pc_);this.pc_.onicegatheringstatechange(e)},e.prototype.processRemaining=function(){0==this.candidates_.length&&"complete"==this.state_?(this.pc_.onicecandidate({candidate:null,target:this}),this.postUpdate()):a.logger.log(this.pc_.user_friendly_id()+".onicecandidate: candidates remaining=["+this.candidates_.map(function(e){return e.object_id()})+"], state="+this.state_)},e}(),g=function(e){function t(t,n,i){for(var o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return e.apply(this,[t,r.class_id_t.RTCSessionDescription,n,i,null].concat(o))||this}return __extends(t,e),t.prototype.toJSON=function(){return{type:this.type_,sdp:this.sdp_}},Object.defineProperty(t.prototype,"sdp",{get:function(){return this.sdp_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.type_},enumerable:!0,configurable:!0}),t.prototype.syncBarrier=function(){var e=this;return a.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.waitUntilConnected("SessionDescription.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,r.method_id_RTCSessionDescription_t.type,0),e.remoteInvoke(!1,r.method_id_RTCSessionDescription_t.sdp,"")])}).then(function(n){e.type_=e.convertType(e.param0(n[0])),e.sdp_=e.param0(n[1]),t(e)}).catch(function(){n()})})},t.prototype.convertType=function(e){return 0==e?"offer":1==e?"pranswer":"answer"},t.convertC2H=function(e){return"offer"==e?0:"pranswer"==e?1:2},t}(o.ProxyObject);t.SessionDescription=g;var h=function(e,t){this.type=e,this.target=t},m=function(e){function t(t,n){var i=e.call(this,t,r.class_id_t.RTCRtpReceiver,n,!0)||this;return a.logger.log(i.user_friendly_id()+".constructor"),i}return __extends(t,e),t.prototype.syncBarrier=function(){var e=this;return a.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,n){e.waitUntilConnected("RtpReceiver.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,r.method_id_RTCRtpReceiver_t.track,{oid:e.object_id()}),e.remoteInvoke(!1,r.method_id_RTCRtpReceiver_t.getContributingSources,[])])}).then(function(t){var n;return t=t.map(function(t){return e.param0(t)}),n=t[0],e.contribsources=t[1],void 0==e.track_||e.track_.object_id()!=n.oid?new i.RemoteMediaTrack(e,n.oid).syncBarrier():Promise.resolve(e.track_)}).then(function(n){e.track_=n,t(e)}).catch(function(){a.logger.log(e.user_friendly_id()+".syncBarrier(): rejected."),n()})})},Object.defineProperty(t.prototype,"track",{get:function(){return a.logger.log(this.user_friendly_id()+".get track() called."),this.track_},enumerable:!0,configurable:!0}),t.prototype.getCapabilities=function(e){return a.logger.log(this.user_friendly_id()+".getCapabilities() called."),this.capabilities},t.prototype.getContributingSources=function(){var e=this;return a.logger.log(this.user_friendly_id()+".getContributingSources() called. "+JSON.stringify(this.contribsources)),this.waitUntilConnected("PeerConnection.getReceivers").then(function(){return Promise.all([e.remoteInvoke(!1,r.method_id_RTCRtpReceiver_t.getContributingSources,[])])}).then(function(t){e.contribsources=t.map(function(t){return e.param0(t)})[0]}).catch(function(){a.logger.log(e.user_friendly_id()+".getContributingSources() didnt get response."),e.contribsources=[]}),this.contribsources},t.prototype.getParameters=function(){return a.logger.log(this.user_friendly_id()+".getParameters() called."),null},t.prototype.getStats=function(){return a.logger.log(this.user_friendly_id()+".getStats() called."),null},t.prototype.getSynchronizationSources=function(){return a.logger.log(this.user_friendly_id()+".getSynchronizationSources() called."),this.syncsources},t}(o.ProxyObject),f=function(){function e(e,t){this.local=e,this.remote=t}return Object.defineProperty(e.prototype,"active",{get:function(){var e=!1;return 1!=this.local&&1!=this.remote||(e=!0),e},enumerable:!0,configurable:!0}),e}();e=function(e){function t(t){var n=e.call(this,null,r.class_id_t.RTCPeerConnection,0,!1,null,void 0!=t?t:{},{})||this;return n.timeerstarted_=!1,n.firsttimeremoteoffer_=!1,n.firststable_=!1,n.firsttimelocaloffer_=!1,n.audiocall_=new f(!1,!1),n.videocall_=new f(!1,!1),n.screensharingcall_=new f(!1,!1),n.conferencecall_=!1,n.incomingcall_=!1,n.outgoingcall_=!1,a.logger.log("peerconnection.constructor"),a.logger.log(JSON.stringify(t)),n.localStreams=[],n.remoteStreams=[],n.onaddstream_=null,n.signalingState_="stable",n.iceConnectionState_="new",n.iceGatheringState_="new",n.iceQ_=new u(n),n.receivers_=[],n.registerStateChangeNotification(n.onStateChange),n}return __extends(t,e),t.prototype.onStateChange=function(){var e=new h("iceconnectionstatechange",this);this.oniceconnectionstatechange_&&this.oniceconnectionstatechange_(e)},t.prototype.addIceCandidate=function(){a.logger.log(this.user_friendly_id()+".addIceCandidate"),a.logger.log(arguments)},Object.defineProperty(t.prototype,"onicecandidate",{get:function(){return this.onicecandidate_},set:function(e){var t=this;a.logger.log(this.user_friendly_id()+".set_onicecandidate() called."),this.onicecandidate_=e,this.waitUntilConnected("PeerConnection.onicecandidate").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),r.method_id_RTCPeerConnection_t.onicecandidate);return n.then(function(e){a.logger.log(t.user_friendly_id()+".onicecandidate callback received!!!"),e=new d(t,t.param0(e).oid,t),null!=t.iceQ_&&t.iceQ_.addIceCandidate(e)}),t.remoteInvoke(!0,r.method_id_RTCPeerConnection_t.onicecandidate,n.success)}).catch(function(){a.logger.log(t.user_friendly_id()+".set_onicecandidate() failed.")})},enumerable:!0,configurable:!0}),t.prototype.convertIceConnectionState=function(e){return 0==e?"new":1==e?"checking":2==e?"connected":3==e?"completed":4==e?"failed":5==e?"disconnected":"closed"},Object.defineProperty(t.prototype,"oniceconnectionstatechange",{get:function(){return this.oniceconnectionstatechange_},set:function(e){var t=this;a.logger.log(this.user_friendly_id()+".set_oniceconnectionstatechange() called."),this.oniceconnectionstatechange_=e,this.waitUntilConnected("PeerConnection.oniceconnectionstatechange").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),r.method_id_RTCPeerConnection_t.oniceconnectionstatechange);return n.then(function(e){a.logger.log(t.user_friendly_id()+".oniceconnectionstatechange(): success callback received!!!"),t.iceConnectionState_=t.convertIceConnectionState(t.param0(e)),e=new h("iceconnectionstatechange",t),t.oniceconnectionstatechange_(e)}),t.remoteInvoke(!0,r.method_id_RTCPeerConnection_t.oniceconnectionstatechange,n.success)}).catch(function(){a.logger.log(t.user_friendly_id()+".set_oniceconnectionstatechange() failed.")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"iceConnectionState",{get:function(){return a.logger.log(this.user_friendly_id()+".get_iceConnectionState() called, value = "+this.iceConnectionState_),this.isRedirected()?this.iceConnectionState_:"failed"},enumerable:!0,configurable:!0}),t.prototype.convertIceGatheringState=function(e){return 0==e?"new":1==e?"gathering":"complete"},Object.defineProperty(t.prototype,"onicegatheringstatechange",{get:function(){return this.onicegatheringstatechange_},set:function(e){var t=this;a.logger.log(this.user_friendly_id()+".set_onicegatheringstatechange() called."),this.onicegatheringstatechange_=e,this.waitUntilConnected("PeerConnection.onicegatheringstatechange").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),r.method_id_RTCPeerConnection_t.onicegatheringstatechange);return n.then(function(e){a.logger.log(t.user_friendly_id()+".onicegatheringstatechange(): callback received!!!"),t.iceGatheringState_=t.convertIceGatheringState(t.param0(e)),null!=t.iceQ_&&t.iceQ_.pushState(t.iceGatheringState_)}),t.remoteInvoke(!0,r.method_id_RTCPeerConnection_t.onicegatheringstatechange,n.success)}).catch(function(){a.logger.log(t.user_friendly_id()+".set_onicegatheringstatechange() failed.")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"iceGatheringState",{get:function(){return a.logger.log(this.user_friendly_id()+".get_iceGatheringState() called, value = "+this.iceGatheringState_),this.iceGatheringState_},enumerable:!0,configurable:!0}),t.prototype.convertSignalState=function(e){return 0==e?"stable":1==e?"have-local-offer":2==e?"have-local-pranswer":3==e?"have-remote-offer":4==e?"have-remote-pranswer":"closed"},t.prototype.TelemtryReadings_=function(){if("have-local-offer"==this.signalingState_&&0==this.firsttimelocaloffer_&&0==this.firsttimeremoteoffer_&&(this.outgoingcallstart_=(new Date).getTime(),0==this.outgoingcall_&&(this.SendTelemetryData(c.tel_key_PerfCallState,c.tel_CallState.active,1),this.SendTelemetryData(c.tel_key_PerfCallDirection,c.tel_CallDirection.outgoing,1),this.outgoingcall_=!0),this.firsttimelocaloffer_=!0),"have-remote-offer"==this.signalingState_&&0==this.firsttimeremoteoffer_&&0==this.firsttimelocaloffer_&&(this.incomingcallstart_=(new Date).getTime(),0==this.incomingcall_&&(this.SendTelemetryData(c.tel_key_PerfCallState,c.tel_CallState.active,1),this.SendTelemetryData(c.tel_key_PerfCallDirection,c.tel_CallDirection.incoming,1),this.incomingcall_=!0),this.firsttimeremoteoffer_=!0),"stable"==this.signalingState_&&0==this.firststable_&&(this.callstartTime_=(new Date).getTime(),this.firststable_=this.timeerstarted_=!0),"stable"==this.signalingState_){for(var e=0,t=this.localStreams;e<t.length;e++){var n=t[e];if(1<=n.getAudioTracks().length&&0==this.audiocall_.local&&(this.SendTelemetryData(c.tel_key_PerfCallType,c.tel_CallType.audio,1),this.audiocall_.local=!0),1<=(n=n.getVideoTracks()).length)for(var i=0,o=n;i<o.length;i++)1==(n=o[i]).getSettings().deviceId.includes("display")?0==this.screensharingcall_.local&&(this.SendTelemetryData(c.tel_key_PerfCallType,c.tel_CallType.dshare,1),this.screensharingcall_.local=!0):0==this.videocall_.local&&(this.SendTelemetryData("Perf_CallType",c.tel_CallType.video,1),this.videocall_.local=!0)}for(e=0,t=this.remoteStreams;e<t.length;e++)if(1<=(n=t[e]).getAudioTracks().length&&0==this.audiocall_.remote&&(this.SendTelemetryData(c.tel_key_PerfCallType,c.tel_CallType.audio,1),this.audiocall_.remote=!0),1<=(i=n.getVideoTracks()).length)for(n=0;n<i.length;n++)1==i[n].id.includes("applicationsharingVideo")?0==this.screensharingcall_.remote&&(this.SendTelemetryData(c.tel_key_PerfCallType,c.tel_CallType.dshare,1),this.screensharingcall_.remote=!0):0==this.videocall_.remote&&(this.SendTelemetryData(c.tel_key_PerfCallType,c.tel_CallType.video,1),this.videocall_.remote=!0);2<this.getReceivers().length&&0==this.conferencecall_&&(this.SendTelemetryData(c.tel_key_PerfCallType,c.tel_CallType.multi,1),this.conferencecall_=!0)}},Object.defineProperty(t.prototype,"onsignalingstatechange",{set:function(e){var t=this;a.logger.log(this.user_friendly_id()+".set_onsignalingstatechange() called."),this.onsignalingstatechange_=e,this.waitUntilConnected("PeerConnection.onsignalingstatechanged").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),r.method_id_RTCPeerConnection_t.onsignalingstatechange);return n.then(function(e){a.logger.log(t.user_friendly_id()+".onsignalingstatechange(): callback received!!!"),t.signalingState_=t.convertSignalState(t.param0(e)),e=new h("onsignalingstatechange",t),t.onsignalingstatechange_(e),t.TelemtryReadings_()}),t.remoteInvoke(!0,r.method_id_RTCPeerConnection_t.onsignalingstatechange,n.success)}).catch(function(){a.logger.log(t.user_friendly_id()+".set_onsignalingstatechange(): failed.")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onsignalingstatechanged",{get:function(){return this.onsignalingstatechange_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"signalingState",{get:function(){return a.logger.log(this.user_friendly_id()+".get_signalingState() called, value = "+this.signalingState_),this.signalingState_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onnegotiationneeded",{get:function(){return this.onnegotiationneeded_},set:function(e){var t=this;a.logger.log(this.user_friendly_id()+".set_onnegotiationneeded() called."),this.onnegotiationneeded_=e,this.waitUntilConnected("PeerConnection.onnegotiationneeded").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),r.method_id_RTCPeerConnection_t.onnegotiationneeded);return n.then(function(){a.logger.log(t.user_friendly_id()+".onnegotiationneeded(): callback received!!!");var e=new h("negotiationneeded",t);t.onnegotiationneeded_(e)}),t.remoteInvoke(!0,r.method_id_RTCPeerConnection_t.onnegotiationneeded,n.success)}).catch(function(){a.logger.log(t.user_friendly_id()+".set_onnegotiationneeded(): failed.")})},enumerable:!0,configurable:!0}),t.prototype.fix_constraints=function(e){var t={audio:!0,video:!0};return e&&(t.video=e.offerToReceiveVideo,t.audio=e.offerToReceiveAudio),t},t.prototype.createOffer=function(e,t,n){var i=this;a.logger.log(this.user_friendly_id()+".createOffer() called.",JSON.stringify(n)),this.waitUntilConnected("PeerConnection.createOffer").then(function(){var e=i.registerCallbacks(!0,!1,r.method_id_RTCPeerConnection_t.createOffer);return i.remoteInvoke(!1,r.method_id_RTCPeerConnection_t.createOffer,e.success,e.fail,i.fix_constraints(n)),e.prom()}).then(function(e){return a.logger.log(i.user_friendly_id()+".createOffer(): success callback received!!!"),new g(i,i.param0(e).oid,!0).syncBarrier()}).then(function(t){e&&e(t)}).catch(function(){a.logger.log(i.user_friendly_id()+".createOffer() failed."),t&&t(new DOMException("PeerConnection.createOffer() failed.","PeerConnection"))})},t.prototype.createAnswer=function(e,t,n){var i=this;a.logger.log(this.user_friendly_id()+".createAnswer() called.",JSON.stringify(n)),this.waitUntilConnected("PeerConnection.createAnswer").then(function(){var e=i.registerCallbacks(!0,!1,r.method_id_RTCPeerConnection_t.createAnswer);return i.remoteInvoke(!1,r.method_id_RTCPeerConnection_t.createAnswer,e.success,e.fail,i.fix_constraints(n),{}),e.prom()}).then(function(e){return a.logger.log(i.user_friendly_id()+".createAnswer(): success callback received!!!"),new g(i,i.param0(e).oid,!0).syncBarrier()}).then(function(t){e&&e(t)}).catch(function(){a.logger.log(i.user_friendly_id()+".createAnswer() failed."),t&&t("PeerConnection::createAnswer() failed.")})},t.prototype.updateLocalDescription=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(i){switch(i.label){case 0:return a.logger.log(this.user_friendly_id()+".updateLocalDescription() called."),[4,this.remoteInvoke(!1,r.method_id_RTCPeerConnection_t.localDescription,{oid:this.object_id()})];case 1:return e=i.sent(),t=new g(this,this.param0(e).oid,!0),[4,t.syncBarrier()];case 2:return this.localDescription=n=i.sent(),[2]}})})},t.prototype.setLocalDescription=function(e,t,n){var i=this;a.logger.log(this.user_friendly_id()+".setLocalDescription() called."),this.waitUntilConnected("PeerConnection.setLocalDescription").then(function(){return new g(i,0,!1,{type:g.convertC2H(e.type),sdp:e.sdp}).syncBarrier()}).then(function(e){var n=i.registerCallbacks(!0,!1,r.method_id_RTCPeerConnection_t.setLocalDescription);i.remoteInvoke(!1,r.method_id_RTCPeerConnection_t.setLocalDescription,{oid:e.object_id()},n.success,n.fail),n.prom().then(function(){a.logger.log(i.user_friendly_id()+".setLocalDescription(): success callback received!!!"),i.localDescription=e,t&&t()})}).catch(function(){a.logger.log(i.user_friendly_id()+".setLocalDescription() failed."),n&&n("PeerConnection::setLocalDescription() failed.")})},t.prototype.setRemoteDescription=function(e,t,n){var i=this;a.logger.log(this.user_friendly_id()+".setRemoteDescription() called."),this.waitUntilConnected("PeerConnection.setRemoteDescription").then(function(){return new g(i,0,!1,{type:g.convertC2H(e.type),sdp:e.sdp}).syncBarrier()}).then(function(e){var n=i.registerCallbacks(!0,!1,r.method_id_RTCPeerConnection_t.setRemoteDescription);i.remoteInvoke(!1,r.method_id_RTCPeerConnection_t.setRemoteDescription,{oid:e.object_id()},n.success,n.fail),n.prom().then(function(){a.logger.log(i.user_friendly_id()+".setRemoteDescription(): success callback received!!!"),i.remoteDescription=e,t&&t()})}).catch(function(){a.logger.log(i.user_friendly_id()+".setRemoteDescription() failed."),n&&n("PeerConnection::setRemoteDescription() failed.")})},t.prototype.getLocalStreams=function(){a.logger.log("PeerConnection.getLocalStreams() called. [oid="+this.object_id()+"]");for(var e=0,t=this.localStreams;e<t.length;e++)a.logger.log(JSON.stringify(t[e]));return this.localStreams},t.prototype.getRemoteStreams=function(){a.logger.log(this.user_friendly_id()+".getRemoteStreams() called.");for(var e=0,t=this.remoteStreams;e<t.length;e++)a.logger.log(JSON.stringify(t[e]));return this.remoteStreams},t.prototype.addStream=function(e){var t=this;a.logger.log(this.user_friendly_id()+".addStream() called: "+JSON.stringify(e)),e.dumpTrackInfo(),this.localStreams.push(e),this.waitUntilConnected("PeerConnection.addStream").then(function(){return t.remoteInvoke(!1,r.method_id_RTCPeerConnection_t.addStream,{oid:e.object_id()},{})}).then(function(){a.logger.log(t.user_friendly_id()+".addStream() success.")}).catch(function(){a.logger.log(t.user_friendly_id()+".addStream() failed.")})},t.prototype.removeStream=function(e){var t=this;a.logger.log(this.user_friendly_id()+".removeStream() called: "+JSON.stringify(e));for(var n=0;n<this.localStreams.length;n++)this.localStreams[n]==e&&this.localStreams.splice(n,1);this.waitUntilConnected("PeerConnection.removeStream").then(function(){return t.remoteInvoke(!1,r.method_id_RTCPeerConnection_t.removeStream,{oid:e.object_id()})}).then(function(){a.logger.log(t.user_friendly_id()+".removeStream() success.")}).catch(function(){a.logger.log(t.user_friendly_id()+".removeStream() failed.")})},Object.defineProperty(t.prototype,"onaddstream",{get:function(){return this.onaddstream_},set:function(e){var t=this;a.logger.log(this.user_friendly_id()+".set_onaddstream() called."),this.onaddstream_=e,this.waitUntilConnected("PeerConnection.onaddstream").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),r.method_id_RTCPeerConnection_t.onaddstream);return n.then(function(e){new i.RemoteStreamEvent(t,t.param0(e).oid).syncBarrier().then(function(e){for(var n=0,i=e.stream.getAudioTracks();n<i.length;n++)i[n].enabled=!1;a.logger.log(t.user_friendly_id()+".onaddstream callback received!"),t.remoteStreams.push(e.stream),t.onaddstream_(e)})}),t.remoteInvoke(!0,r.method_id_RTCPeerConnection_t.onaddstream,n.success)}).catch(function(){a.logger.log(t.user_friendly_id()+".set_onaddstream(): failed!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onremovestream",{get:function(){return this.onremovestream_},set:function(e){var t=this;a.logger.log(this.user_friendly_id()+".set_onremovestream() called."),this.onremovestream_=e,this.waitUntilConnected("PeerConnection.onremovestream").then(function(){var n=t.registerCallbacks(!1,t.isNullCallback(e),r.method_id_RTCPeerConnection_t.onremovestream);return n.then(function(e){new i.RemoteStreamEvent(t,t.param0(e).oid).syncBarrier().then(function(e){a.logger.log(t.user_friendly_id()+".onremovestream callback received!");var n=t.remoteStreams.findIndex(function(t){return t.id==e.stream.id});0<=n&&t.remoteStreams.splice(n,1),t.onremovestream_(e)})}),t.remoteInvoke(!0,r.method_id_RTCPeerConnection_t.onremovestream,n.success)}).catch(function(){a.logger.log(t.user_friendly_id()+".set_onremovestream(): failed!")})},enumerable:!0,configurable:!0}),t.prototype.getStats=function(e){a.logger.log(this.user_friendly_id()+".getStats");var t=this;return new Promise(function(n,i){t.isRedirected()?t.waitUntilConnected("PeerConnection.getStats").then(function(){var i=t.registerCallbacks(!0,!1,r.method_id_RTCPeerConnection_t.getStats);return i.then(function(t){void 0!==t.params&&0!==t.params.length&&(e(s.StatsReport.fromJSON(JSON.parse(t.params[0]))),n())}),t.remoteInvoke(!1,r.method_id_RTCPeerConnection_t.getStats,i.success)}).catch(function(){a.logger.log(t.user_friendly_id()+".getStats(): failed!"),i()}):(a.logger.log(t.user_friendly_id()+".getStats(): not in active redirection!"),e({}),n())})},t.prototype.SendTelemetryData=function(e,t,i){n.getRedirector().telemetry.SendTelemetryData(c.tel_cmd.Data,e,t,i)},t.prototype.MillisecondstoDisplayformat_=function(e){var t,n;n=Math.floor(e/1e3),t=Math.floor(n/60),e=Math.floor(t/60),a.logger.log(Math.floor(e/24)+":"+e%24+":"+t%60+":"+n%60)},t.prototype.CalculateCallDurationandType_=function(){if(1==this.timeerstarted_){this.callendTime_=(new Date).getTime();var e=this.callendTime_-this.callstartTime_;this.MillisecondstoDisplayformat_(e),e=Math.round(e/1e3),a.logger.log("Call Duration "+e),1==this.conferencecall_?this.SendTelemetryData(c.tel_key_ConferenceCallDuration,e,1):(1==this.audiocall_.active&&this.SendTelemetryData(c.tel_key_AudioCallDuration,e,1),1==this.videocall_.active&&this.SendTelemetryData(c.tel_key_VideoCallDuration,e,1),1==this.screensharingcall_.active&&this.SendTelemetryData(c.tel_key_ScreensharingCallDuration,e,1));var t;1==this.firsttimelocaloffer_&&(t=this.callstartTime_-this.outgoingcallstart_),1==this.firsttimeremoteoffer_&&(t=this.callstartTime_-this.incomingcallstart_),this.MillisecondstoDisplayformat_(t),t=Math.round(t/1e3),a.logger.log("Call Establish Time "+t),1==this.incomingcall_?this.SendTelemetryData(c.tel_key_CallEstIncoming,t,1):1==this.outgoingcall_&&this.SendTelemetryData(c.tel_key_CallEstOutgoing,t,1),this.timeerstarted_=!1,this.SendTelemetryData(c.tel_key_PerfCallState,c.tel_CallState.idle,1)}},t.prototype.close=function(){var e=this;a.logger.log(this.user_friendly_id()+".close() called."),this.CalculateCallDurationandType_(),this.unregisterStateChangeNotification(this.onStateChange),this.onnegotiationneeded=this.onsignalingstatechange=this.onicegatheringstatechange=this.oniceconnectionstatechange=this.onicecandidate=this.onaddstream=null,this.waitUntilConnected("PeerConnection.close").then(function(){return e.remoteInvoke(!1,r.method_id_RTCPeerConnection_t.close)}).then(function(){e.iceQ_=null,e.release(),a.logger.log(e.user_friendly_id()+".close() success.")}).catch(function(){e.iceQ_=null,e.release(),a.logger.log(e.user_friendly_id()+".close() failed.")})},t.prototype.getSenders=function(){a.logger.log(this.user_friendly_id()+".getSenders() called.")},t.prototype.getReceivers=function(){var e=this;return a.logger.log(this.user_friendly_id()+".getReceivers() called."),this.waitUntilConnected("PeerConnection.getReceivers").then(function(){return e.remoteInvoke(!1,r.method_id_RTCPeerConnection_t.getReceivers,[])}).then(function(t){var n=[];return t.params[0].forEach(function(t){var i=e.receivers_.find(function(e){return e.object_id()===t.oid});void 0===i?(i=new m(e,t.oid),n.push(i.syncBarrier())):n.push(i)}),Promise.all(n)}).then(function(t){a.logger.log(e.user_friendly_id()+".getReceivers: returning receiver with ids ["+t.map(function(e){return e.object_id()})+"]"),e.receivers_=t}).catch(function(){a.logger.log(e.user_friendly_id()+".getReceivers() didnt get response."),e.receivers_=[]}),this.receivers_},t}(o.ProxyObject),t.PeerConnection=e}),define("videoelement",["require","exports","proxyobject","webrpcclassinfo","logger"],function(e,t,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){this.x=Math.round(e.x),this.y=Math.round(e.y),this.width=Math.round(e.width),this.height=Math.round(e.height)};t.VideoRect=r,e=function(e){function t(){var t=e.call(this,null,i.class_id_t.VideoElement,0,!1)||this;return t.srcObject_=null,t.sinkId_="",t.videoWidth=0,t.videoHeight=0,t.isLoaded=!1,t.connectionState="disconnected",t.dispose_=!1,t.disposeTimer=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"sinkId",{get:function(){return this.sinkId_},set:function(e){var t=this;this.waitUntilConnected("VideoElement.sinkId").then(function(){return t.remoteInvoke(!0,i.method_id_VideoElement_t.sinkId,e)}).then(function(){t.sinkId_=e}).catch(function(){o.logger.log(t.user_friendly_id()+".sinkId setter: failed to connect!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"srcObject",{get:function(){return this.srcObject_},set:function(e){o.logger.log(this.user_friendly_id()+".srcObject: set srcObject..."),this.srcObject_!==e&&(!0===this.dispose_&&null!==this.disposeTimer&&(clearTimeout(this.disposeTimer),this.disposeTimer=null,this.dispose_=!1),null!==this.srcObject_&&(null===e&&(this.dispose_=!0),this.disconnect(),this.isLoaded=!1),this.srcObject_=e,null!==this.srcObject_&&this.connectTo(this.srcObject_))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onconnectionstatechange",{get:function(){return this.onconnectionstatechange_},set:function(e){o.logger.log(this.user_friendly_id()+".set_onconnectionstatechange() called."),this.onconnectionstatechange_=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onloadedmetadata",{set:function(e){o.logger.log(this.user_friendly_id()+".set_onloadedmetadata() called."),this.onloadedmetadata_=e},enumerable:!0,configurable:!0}),t.prototype.setupOnVideoFrameChanged=function(){var e=this,t=this.registerCallbacks(!1,!1,i.method_id_VideoElement_t.onvideoframechanged);t.then(function(t){o.logger.log(e.user_friendly_id()+".onvideoframechanged",t.params),e.videoWidth=t.params[0]||0,e.videoHeight=t.params[1]||0,e.isLoaded||(e.isLoaded=!0,e.onloadedmetadata_&&e.onloadedmetadata_())}),this.remoteInvoke(!0,i.method_id_VideoElement_t.onvideoframechanged,t.success)},t.prototype.connectTo=function(e){var t=this;console.log(this.user_friendly_id()+".connectTo: connect media stream with id = "+e.object_id()+", clone_id = "+e.clone_state.clone_id),this.waitUntilConnected("VideoElement.connectTo").then(function(){return t.setupOnVideoFrameChanged(),e.clone_state.synchronize(e)}).then(function(e){var n=t.registerCallbacks(!0,!1,i.method_id_VideoElement_t.connectTo);return Promise.all([t.remoteInvoke(!1,i.method_id_VideoElement_t.connectTo,{oid:e.object_id()},n.success,n.fail),n.prom()])}).then(function(e){o.logger.log(t.user_friendly_id()+".connectTo: remote media stream is connected!"),t.connectionState="connected",t.onconnectionstatechange_&&t.onconnectionstatechange_(),t.updateTimer=setInterval(function(){t.ontimeupdate&&t.ontimeupdate()},250)}).catch(function(e){o.logger.log(t.user_friendly_id()+".connectTo: failed to connect! msg = ",e)})},t.prototype.disconnect=function(){var e=this;o.logger.log(this.user_friendly_id()+".disconnect: disconnect from current media stream"),!0===this.dispose_&&(this.disposeTimer=setTimeout(function(){e.release()},5e3)),this.waitUntilConnected("VideoElement.disconnect").then(function(){e.updateTimer&&clearInterval(e.updateTimer);var t=e.registerCallbacks(!1,!0,i.method_id_VideoElement_t.onvideoframechanged);return e.remoteInvoke(!0,i.method_id_VideoElement_t.onvideoframechanged,t.success),e.remoteInvoke(!1,i.method_id_VideoElement_t.disconnect)}).then(function(){o.logger.log(e.user_friendly_id()+".disconnect: remote media stream is disconnected!"),e.connectionState="disconnected",e.onconnectionstatechange_&&e.onconnectionstatechange_()}).catch(function(){o.logger.log(e.user_friendly_id()+".disconnect: failed to connect!")})},t.prototype.setFrame=function(e){var t=this;o.logger.log(this.user_friendly_id()+".setFrame: set video frame to",e.x,e.y,e.width,e.height),this.waitUntilConnected("VideoElement.setFrame").then(function(){var n=new r(e);return t.remoteInvoke(!1,i.method_id_VideoElement_t.setFrame,n)}).then(function(){o.logger.log(t.user_friendly_id()+".setFrame: success!")}).catch(function(){o.logger.log(t.user_friendly_id()+".setFrame: failed to connect!")})},t.prototype.addClipRect=function(e){var t=this;o.logger.log(this.user_friendly_id()+".addClipRect: ",JSON.stringify(e)),this.waitUntilConnected("VideoElement.addClipRect").then(function(){var n=new r(e);return t.remoteInvoke(!1,i.method_id_VideoElement_t.addClipRect,n)}).catch(function(){o.logger.log(t.user_friendly_id()+".addClipRect failed!")})},t.prototype.removeClipRect=function(e){var t=this;o.logger.log(this.user_friendly_id()+".removeClipRect: ",JSON.stringify(e)),this.waitUntilConnected("VideoElement.removeClipRect").then(function(){var n=new r(e);return t.remoteInvoke(!1,i.method_id_VideoElement_t.removeClipRect,n)}).catch(function(){o.logger.log(t.user_friendly_id()+".removeClipRect failed!")})},t}(n.ProxyObject),t.VideoElement=e}),define("audioelement",["require","exports","proxyobject","webrpcclassinfo","logger"],function(e,t,n,i,o){Object.defineProperty(t,"__esModule",{value:!0}),e=function(e){function t(){var t=e.call(this,null,i.class_id_t.AudioElement,0,!1)||this;return t.sinkId_="",t.srcObject_=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"sinkId",{get:function(){return this.sinkId_},set:function(e){var t=this;o.logger.log(this.user_friendly_id()+".sinkId: set sinkId to "+e),this.waitUntilConnected("AudioElement.sinkId").then(function(){return t.remoteInvoke(!0,i.method_id_AudioElement_t.sinkId,e)}).then(function(){t.sinkId_=e}).catch(function(){o.logger.log(t.user_friendly_id()+".sinkId setter: failed to connect!")})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"srcObject",{get:function(){return this.srcObject_},set:function(e){var t=this;if(o.logger.log(this.user_friendly_id()+".srcObject: set srcObject to "+JSON.stringify(e)),e!==this.srcObject_){var n=null!==e?e.object_id():"null";this.waitUntilConnected("AudioElement.srcObject").then(function(){return t.remoteInvoke(!0,i.method_id_AudioElement_t.srcObject,n)}).then(function(){t.srcObject_=e,null===e&&t.release()}).catch(function(){o.logger.log(t.user_friendly_id()+".srcObject setter: failed to connect!"),null===e&&t.release()})}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"src",{get:function(){return this.src_},set:function(e){var t=this;o.logger.log(this.user_friendly_id()+".src: set src to "+e),this.src_=e,this.waitUntilConnected("AudioElement.src").then(function(){t.remoteInvoke(!0,i.method_id_AudioElement_t.src,e)}).catch(function(){o.logger.log(t.user_friendly_id()+".src setter: failed to connect!")})},enumerable:!0,configurable:!0}),t.prototype.play=function(){var e=this;o.logger.log(this.user_friendly_id()+".play() called."),this.waitUntilConnected("AudioElement.play").then(function(){e.remoteInvoke(!1,i.method_id_AudioElement_t.play,[])}).catch(function(){o.logger.log(e.user_friendly_id()+".play: failed to connect!")})},t.prototype.pause=function(){var e=this;o.logger.log(this.user_friendly_id()+".pause() called."),this.waitUntilConnected("AudioElement.pause").then(function(){e.remoteInvoke(!1,i.method_id_AudioElement_t.pause,[])}).catch(function(){o.logger.log(e.user_friendly_id()+".pause: failed to connect!")})},t}(n.ProxyObject),t.AudioElement=e}),define("frametracker",["require","exports","logger","hdxms"],function(e,t,n,i){Object.defineProperty(t,"__esModule",{value:!0}),e=function(){function e(){var t=this;this.running_=!1,this.elements_=[],this.clipRects=new Set,this.wheelEventHandler=function(e){setTimeout(function(){t.updateAll()},10)},this.keyupEventHandler=function(e){"Tab"!=e.code&&"ArrowUp"!=e.code&&"ArrowDown"!=e.code&&"ArrowLeft"!=e.code&&"ArrowRight"!=e.code&&"PageUp"!=e.code&&"PageDown"!=e.code&&"Home"!=e.code&&"End"!=e.code||t.updateAll()},e.sendOverlayInfo(),this.observer_=new MutationObserver(function(e){t.updateAll()})}return e.sendOverlayInfo=function(){var e=window.getWindowHandleAsHex;if(void 0===e||null===e)n.logger.log("FrameTracker.sendOverlayInfo: getWindowHandle method is undefined or null");else{var t=i.getRedirector();Promise.all([e(),t.startRedirection(!1,"sendOverlayInfo")]).then(function(e){n.logger.log("FrameTracker.sendOverlayInfo: set window handle: "+e[0]),t.WSSendObject({v:"overlay",command:"window",windowHandle:e[0]})})}},e.prototype.rectanglesIntersect=function(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y},e.prototype.intersectingRect=function(e,t){var n=Math.max(e.left,t.left),i=Math.max(e.top,t.top);return new DOMRect(n,i,Math.min(e.right,t.right)-n,Math.min(e.bottom,t.bottom)-i)},e.prototype.pedigreeCount=function(e,t){for(var n=0,i=e.parentElement;null!=i&&i!=t;)n++,i=i.parentElement;return{isAncestor:null!=i,pedigree:n}},e.prototype.selectTopmost=function(e,t){var n=e.getBoundingClientRect(),i=t.getBoundingClientRect(),n=this.intersectingRect(n,i);if((i=document.elementFromPoint(n.left+n.width/2,n.top+n.height/2))==e)return e;if(i==t)return t;if(n=this.pedigreeCount(e,i),i=this.pedigreeCount(t,i),n.isAncestor&&i.isAncestor){if(n.pedigree<i.pedigree)return e;if(i.pedigree<n.pedigree)return t}else{if(n.isAncestor)return e;if(i.isAncestor)return t}},e.prototype.checkOverlappingVideos=function(e){var t=this,n=e.target.getBoundingClientRect();e.overlaps.forEach(function(t){e.target.remoteVideoElement.removeClipRect(t.rect)}),e.overlaps=[],this.elements_.forEach(function(i){if(i!=e){var o=i.overlaps.map(function(e){return e.element}).indexOf(e.target);if(-1!=o&&(o=i.overlaps.splice(o,1)[0],i.target.remoteVideoElement.removeClipRect(o.rect)),o=i.target.getBoundingClientRect(),t.rectanglesIntersect(n,o)){var r=t.selectTopmost(e.target,i.target);r==e.target?(i.overlaps.push({element:e.target,rect:n}),i.target.remoteVideoElement.addClipRect(n)):r==i.target&&(e.overlaps.push({element:i.target,rect:o}),e.target.remoteVideoElement.addClipRect(o))}}})},e.prototype.updateAll=function(){var e=this;this.elements_.forEach(function(t){var n=t.target.getBoundingClientRect();if(void 0!==n){var i=t.clientRect;void 0!==i&&i.x===n.x&&i.y===n.y&&i.width===n.width&&i.height===n.height||(t.clientRect=n,t.callback(n),e.checkOverlappingVideos(t))}})},e.prototype.track=function(e,t){var i=this,o=e.getBoundingClientRect();n.logger.log("Track element frame",e,JSON.stringify(o)),console.log(e),this.elements_.push({target:e,clientRect:void 0,callback:t,overlaps:[]});try{n.logger.log("[HdxWebRTC.js] Initializing occlusion for new videoElement"),this.clipRects.forEach(function(t){i.applyOcclusion(e,JSON.parse(t))})}catch(e){n.logger.log("[HdxWebRTC.js] addOcclusionInit failed! "+e)}this.running_||(n.logger.log("Start FrameTracker observer..."),this.observer_.observe(document.body,{attributes:!0,childList:!0,subtree:!0}),window.addEventListener("wheel",this.wheelEventHandler),window.addEventListener("keyup",this.keyupEventHandler),this.running_=!0),this.updateAll()},e.prototype.untrack=function(e){n.logger.log("Untrack element frame",e);var t=-1;this.elements_.forEach(function(n,i){n.target===e&&(t=i)}),0<=t&&(this.elements_.splice(t,1),0===this.elements_.length&&(n.logger.log("Stop FrameTracker observer..."),this.observer_.disconnect(),window.removeEventListener("wheel",this.wheelEventHandler),window.removeEventListener("keyup",this.keyupEventHandler),this.running_=!1))},e.prototype.applyOcclusion=function(e,t){var n=e.getBoundingClientRect();this.rectanglesIntersect(t,n)&&void 0!==e.remoteVideoElement&&e.remoteVideoElement.addClipRect(t)},e.prototype.addOcclusion=function(e){var t=this;n.logger.log("[HdxWebRTC.js] Adding occlusion "+JSON.stringify(e)),n.logger.log("[HdxWebRTC.js] Tracking '"+this.elements_.length+"' elements."),this.clipRects.add(JSON.stringify(e)),this.elements_.forEach(function(n){t.applyOcclusion(n.target,e)})},e.prototype.removeOcclusion=function(e){n.logger.log("[HdxWebRTC.js] Removing occlusion "+JSON.stringify(e)),n.logger.log("[HdxWebRTC.js] Tracking '"+this.elements_.length+"' elements."),this.clipRects.delete(JSON.stringify(e)),this.elements_.forEach(function(t){void 0!==t.target.remoteVideoElement&&t.target.remoteVideoElement.removeClipRect(e)})},e}(),t.FrameTracker=e}),define("enginecontrol","require exports webrpcclassinfo hdxms proxyobject logger".split(" "),function(e,t,n,i,o,r){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Webrpc=0]="Webrpc",e[e.WebrtcCodecs=1]="WebrtcCodecs",e[e.Receiver=2]="Receiver",e[e.Vda=3]="Vda",e[e.Endpoint=4]="Endpoint",e[e.TypeScript=5]="TypeScript",e[e.Max=6]="Max"}(t.VersionType||(t.VersionType={})),e=function(e){function t(){return e.call(this,null,n.class_id_t.EngineControl,0,!1)||this}return __extends(t,e),t.prototype.bind=function(){r.logger.log(this.user_friendly_id()+".bind() called."),this.reconstructor(null,n.class_id_t.EngineControl,0)},t.prototype.syncBarrier=function(){var e=this;return r.logger.log(this.user_friendly_id()+".syncBarrier() called."),new Promise(function(t,o){e.waitUntilConnected("EngineControl.syncBarrier").then(function(){return Promise.all([e.remoteInvoke(!1,n.method_id_EngineControl_t.version,{major:0,minor:0,revision:0,build:0}),e.remoteInvoke(!1,n.method_id_EngineControl_t.feature_flags,[])])}).then(function(t){r.logger.log(e.user_friendly_id()+"received webrpc version and supported feature list."),t=t.map(function(t){return e.param0(t)}),e.version_=t[0],e.features_=t[1],i.getRedirector().setFeatures(e.features_),t=0;for(var o=e.features_;t<o.length;t++){var a=o[t];if("ms_teams_desktop_sharing"===a.name&&!0===a.value)return Promise.all([e.remoteInvoke(!1,n.method_id_EngineControl_t.version_info,[])])}}).then(function(n){void 0===n?r.logger.log(e.user_friendly_id()+"release-1905 client."):(r.logger.log(e.user_friendly_id()+"release-1906 or later client: received detailed client version list."),e.versions_=n.map(function(t){return e.param0(t)})[0]),t(e)}).catch(function(){r.logger.log(e.user_friendly_id()+"failure to retrieve version/feature related client info."),o()})})},t}(o.ProxyObject),t.EngineControl=e}),define("remotesession","require exports hdxms webrpcclassinfo enginecontrol logger webrpcclassinfo telemetry".split(" "),function(e,t,n,i,o,r,a,s){Object.defineProperty(t,"__esModule",{value:!0});var c;!function(e){e[e.Unknown=0]="Unknown",e[e.Windows=1]="Windows",e[e.Linux=2]="Linux"}(c=t.RemoteType||(t.RemoteType={}));var d=function(){};t.SessionInfo=d,e=function(){function e(){var e=this;this.isremote_=!1,this.isremote_=!0,this.type_=c.Windows,this.address_="0.0.0.0",this.sessioninfo_=null,n.getRedirector().setRemoteSessionInfoCb(function(){return e.remoteSessionInfo()}),this.enginecontrol_=new o.EngineControl}return e.prototype.release=function(){n.getRedirector().setRemoteSessionInfoCb(null)},e.prototype.user_friendly_id=function(){return"[RemoteSession]"},e.prototype.getFeatureFlags=function(){var e={};return null!==this.enginecontrol_&&null!==this.enginecontrol_.features_&&void 0!==this.enginecontrol_.features_&&this.enginecontrol_.features_.forEach(function(t){e[t.name]=t.value}),e},e.prototype.isFeatureSupported=function(e){if("video"===e)return!0;if(!(e in a.featureNameMap))return!1;e=a.featureNameMap[e];for(var t=this.getFeatureFlags(),n=0;n<e.length;n++)if(!(e[n]in t)||!0!==t[e[n]])return!1;return!0},e.prototype.getSessionInfo=function(){return r.logger.log(this.user_friendly_id()+".getSessionInfo() called."),null!=this.sessioninfo_?Promise.resolve(this.sessioninfo_):Promise.reject()},e.prototype.remoteSessionInfo=function(){var e=this;return r.logger.log(e.user_friendly_id()+".remoteSessionInfo() called."),new Promise(function(t,a){e.enginecontrol_.syncBarrier().then(function(n){if(r.logger.log(e.user_friendly_id()+"enginecontrol info received!"),e.sessioninfo_=new d,e.sessioninfo_.type_script=i.HDXMS_VERSION,e.sessioninfo_.webrpc=n.version_.major.toString()+"."+n.version_.minor.toString()+"."+n.version_.revision.toString()+"."+n.version_.build.toString(),void 0!=n.versions_&&null!=n.versions_){e.SendTelemetryData(s.tel_key_VerTypeScript,i.HDXMS_VERSION,1);var a=0,c=0;for(n=n.versions_;c<n.length;c++){var l=(l=n[c]).major.toString()+"."+l.minor.toString()+"."+l.revision.toString()+"."+l.build.toString();switch(a){case o.VersionType.Webrpc:e.sessioninfo_.webrpc=l,e.SendTelemetryData(s.tel_key_VerWebrpc,l,1);break;case o.VersionType.WebrtcCodecs:e.sessioninfo_.webrtc_codecs=l,e.SendTelemetryData(s.tel_key_VerWebrtcCodecs,l,1);break;case o.VersionType.Receiver:e.sessioninfo_.receiver=l,e.SendTelemetryData(s.tel_key_VerReceiver,l,1);break;case o.VersionType.Vda:e.sessioninfo_.vda=l,e.SendTelemetryData(s.tel_key_VerVda,l,1);break;case o.VersionType.Endpoint:e.sessioninfo_.endpoint=l,e.SendTelemetryData(s.tel_key_VerEndpoint,l,1);break;default:r.logger.log(e.user_friendly_id()+"Unknown version type!")}a++}}t(e.sessioninfo_),e.enginecontrol_.release()}).catch(function(){n.getRedirector().isPingActive()?e.retrySessionInfo():(a(),e.enginecontrol_.release(),e.enginecontrol_=null)})})},e.prototype.retrySessionInfo=function(){var e=this;setTimeout(function(){r.logger.log("checking if we are connected..."),e.enginecontrol_.bind(),n.getRedirector().handleRemoteSessionInfo()},15e3)},e.prototype.SendTelemetryData=function(e,t,i){n.getRedirector().telemetry.SendTelemetryData(s.tel_cmd.Data,e,t,i)},e}(),t.RemoteSession=e});var vdishim=require("./peerconnection"),rmshim=require("./remotemedia"),videoelem=require("./videoelement"),audioelem=require("./audioelement"),frametracker=require("./frametracker"),logger=require("./logger").logger,remotesession=require("./remotesession"),garbagecollector=require("./garbagecollector").gc,HdxMediaStream=require("./hdxms");!function(e,t){"object"==typeof module&&module.exports?module.exports=t():e.vdiPeerConnection=t()}("undefined"!=typeof self?self:this,function(){function e(e){HdxMediaStream.getRedirector().SendTelemetryData_Speaker(e)}function t(){window.getCitrixMSTeamsRedir().then(function(e){logger.log("sucesss on connect, CitrixMSTeamsRedir reg value:"+e),"1"===e&&null===g&&(logger.log("supported client"),g=new remotesession.RemoteSession)})}function n(e){if("1"===e)logger.log("Supported client"),HdxMediaStream.getRedirector().pingConnectionBegin(!0);else if("0"===e){logger.log("VDI Event: Unsupported client reported");try{l({event:"vdiClientDisconnected",reason:"endpointUnsupported",msg:"Unsupported endpoint connected"})}catch(e){logger.log("onVMEvent(): exception: "+e.message)}}else logger.log("MS Teams Redir Reg Key value not correct")}function i(e){if(0>=e){logger.log("VDI Event: Reg Key not Updated after timer reported, Fallback");try{l({event:"vdiClientDisconnected",reason:"failure",msg:"Citrix MS Teams Reg Key not Present"})}catch(e){logger.log("onVMEvent(): exception: "+e.message)}}else window.getCitrixMSTeamsRedir().then(function(t){logger.log("CitrixMSTeamsRedir reg value:"+t),"0"===t||"1"===t?n(t):(logger.log("MS Teams Redir Reg key not updated - Start timer"),setTimeout(function(){logger.log("Timer waiting for registry to be updated count :"+e),i(--e)},1e3))})}function o(){logger.log("VDI: sendSessionInfo"),g&&g.getSessionInfo().then(function(e){logger.log("getSessionInfo success! info:"+JSON.stringify(e));try{l({event:"vdiClientConnected",version:e})}catch(e){logger.log("onVMEvent(): exception: "+e.message)}}).catch(function(){logger.log("getSessionInfo failure! session is not fully connected yet...")})}var r=vdishim.PeerConnection,a=new rmshim.NavigatorUserMedia,s=a.webkitGetUserMedia,c=new rmshim.RemoteDevices,d=new frametracker.FrameTracker,l=void 0,u=!1;window.onVdiClientDisconnected=function(e){if(logger.log("VDI Event: vdiClientDisconnected"),logger.log("VDI : cleanup"),HdxMediaStream.getRedirector().clearReqs(),d=c=a=null,g&&g.release(),g=null,garbagecollector.reset(),logger.log("VDI : cleanup done"),1==e&&!1===u){logger.log("VDI Event: vdiClientDisconnected with failure reported"),u=!0;try{l({event:"vdiClientDisconnected",reason:"failure",msg:"Websocket Connection Failure"})}catch(e){logger.log("onVMEvent(): exception: "+e.message)}}else{u=!1;try{l({event:"vdiClientDisconnected",reason:"endpointDisconnected"})}catch(e){logger.log("onVMEvent(): exception: "+e.message)}}};var g=new remotesession.RemoteSession;return window.onVdiClientDisconnectedTimer=function(){logger.log("VDI Event: onVdiClientDisconnectedTimer"),null===g&&(g=new remotesession.RemoteSession)},window.onVdiClientConnected=function(){logger.log("VDI Event: vdiClientConnected"),frametracker.FrameTracker.sendOverlayInfo(),o(),null!==c&&c.isValid()||(c=new rmshim.RemoteDevices)},{createPeerConnection:function(e,n){t();var i=new r(e,n),o=i.createOffer;i.createOffer=function(){return logger.log("VDI Shim createOffer"),o.apply(i,arguments)};var a=i.createAnswer;i.createAnswer=function(){return logger.log("VDI Shim createAnswer"),a.apply(i,arguments)};var s=i.setRemoteDescription;i.setRemoteDescription=function(){return logger.log("VDI Shim setRemoteDescription"),s.apply(i,arguments)};var c=i.setLocalDescription;i.setLocalDescription=function(){return logger.log("VDI Shim setLocalDescription"),c.apply(i,arguments)};var d=i.createDTMFSender;i.createDTMFSender=function(){return logger.log("VDI Shim createDTMFSender"),d.apply(i,arguments)};var l=i.getLocalStreams;i.getLocalStreams=function(){return logger.log("VDI Shim getLocalStreams"),l.apply(i,arguments)};var u=i.getRemoteStreams;i.getRemoteStreams=function(){return logger.log("VDI Shim getRemoteStreams"),u.apply(i,arguments)};var g=i.getStats;i.getStats=function(){return logger.log("VDI Shim getStats"),g.apply(i,arguments)};var h=i.addStream;i.addStream=function(){return logger.log("VDI Shim addStream"),h.apply(i,arguments)};var m=i.removeStream;i.removeStream=function(){return logger.log("VDI Shim removeStream"),m.apply(i,arguments)};var f=i.getReceivers;i.getReceivers=function(){return logger.log("VDI Shim getReceivers"),f.apply(i,arguments)};var p=i.close;return i.close=function(){return logger.log("VDI Shim close"),p.apply(i,arguments)},i},getUserMediaShim:function(e,n,i){return t(),logger.log("VDI Shim getUserMedia"),null!==a&&a.isValid()||(a=new rmshim.NavigatorUserMedia,s=a.webkitGetUserMedia),s.apply(a,arguments)},getDisplayMediaShim:function(e){return t(),logger.log("VDI Shim getDisplayMedia"),null!==c&&c.isValid()||(c=new rmshim.RemoteDevices),c.getDisplayMedia.apply(c,arguments)},enumerateDevicesShim:function(){return t(),logger.log("VDI Shim enumerateDevices"),null!==c&&c.isValid()||(c=new rmshim.RemoteDevices),c.enumerateDevices.apply(c,arguments)},newAudioElement:function(n){logger.log("VDI New Audio Element Created, Creating Mapping to Thin Client DOM "),void 0!==n.remoteAudioElement?logger.log("Audio element is already configured!!!"):(t(),Object.defineProperty(n,"remoteAudioElement",{writable:!0,value:null}),n.remoteAudioElement=new audioelem.AudioElement,Object.defineProperty(n,"sinkId",{writable:!0}),n.setSinkId=function(t){logger.log("VDI Shim set audio element SinkId value = "+t),n.remoteAudioElement.sinkId=t;var i;rmshim.enumerateddecices.forEach(function(e){t==e.deviceId&&(i=e.label)}),e(i)},Object.defineProperty(n,"srcObject",{get:function(){return n.remoteAudioElement.srcObject},set:function(e){if(logger.log("VDI Shim set audio element srcObject "+JSON.stringify(e)),null===e){if(null!==n.remoteAudioElement.srcObject){e=n.remoteAudioElement.srcObject.getTracks();var t=$jscomp.makeIterator(e);for(e=t.next();!e.done;e=t.next())e.value.enabled=!1}n.remoteAudioElement.release()}else for(n.remoteAudioElement.srcObject=e,e=e.getTracks(),t=$jscomp.makeIterator(e),e=t.next();!e.done;e=t.next())e.value.enabled=!0}}))},newVideoElement:function(e){logger.log("VDI New Video Element Created, Creating Mapping to Thin Client DOM"),null===d&&(d=new frametracker.FrameTracker),void 0!==e.remoteVideoElement?logger.log("Video element is already configured!!!"):(t(),Object.defineProperty(e,"remoteVideoElement",{writable:!0,value:null}),e.remoteVideoElement=new videoelem.VideoElement,e.remoteVideoElement.onloadedmetadata=function(){var t=new Event("loadedmetadata");e.dispatchEvent(t)},e.remoteVideoElement.ontimeupdate=function(){var t=new Event("timeupdate");e.dispatchEvent(t)},e.remoteVideoElement.onconnectionstatechange=function(){"connected"==e.remoteVideoElement.connectionState?d.track(e,function(t){e.remoteVideoElement.setFrame(t)}):d.untrack(e)},Object.defineProperty(e,"sinkId",{get:function(){return e.remoteVideoElement.sinkId},set:function(t){logger.log("VDI Shim set video element SinkId value = "+t),e.remoteVideoElement.sinkId=t}}),Object.defineProperty(e,"srcObject",{get:function(){return e.remoteVideoElement.srcObject},set:function(t){logger.log("VDI Shim set video element srcObject"),e.remoteVideoElement.srcObject=t}}),Object.defineProperty(e,"videoWidth",{get:function(){return e.remoteVideoElement.videoWidth}}),Object.defineProperty(e,"videoHeight",{get:function(){return e.remoteVideoElement.videoHeight}}))},setVMEventCallback:function(e){l=e,logger.log("VDI Event Callback Set")},playNotifyAudio:function(e,t){""!==(t="")&&logger.log("VDI Shim Audio Notification Playing, Remote to Thin Client "+t)},pauseNotifyAudio:function(e,t){""!==(t="")&&logger.log("VDI Shim Audio Notification Paused, Remote to Thin Client "+t)},setSinkId:function(e,t){logger.log("VDI Shim Audio setSinkId audioId:"+e+" sinkId:"+t)},setDefaultSinkId:function(e){logger.log("VDI Shim Audio setSinkId sinkId:"+e)},addClipRect:function(e){logger.log("VDI Adding Occlusion "+JSON.stringify(e)),null===d&&(d=new frametracker.FrameTracker),d.addOcclusion(e)},removeClipRect:function(e){logger.log("VDI Removing Occlusion "+JSON.stringify(e)),null===d&&(d=new frametracker.FrameTracker),d.removeOcclusion(e)},init:function(e){logger.setMSLogger(e),logger.log("VDI init logger")},isFeatureSupported:function(e){return null!==g&&g.isFeatureSupported(e)},connectedStateChanged:function(e){logger.log("VDI : connectedStateChanged to "+e),0==e?logger.log("Disconnecting from the VDA"):(logger.log("Connecting to the VDA"),window.getCitrixMSTeamsRedir().then(function(e){logger.log("Sucesss on connect, CitrixMSTeamsRedir reg value:"+e),"0"===e||"1"===e?n(e):(logger.log("MS Teams Redir Reg key not updated - Start timer"),i(5))}).catch(function(){logger.log("Failure to Read MS Teams redir Reg Key")}))},setLoop:function(e,t){logger.log("VDI : setloop")}}});